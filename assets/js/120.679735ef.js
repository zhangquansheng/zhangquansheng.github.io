(window.webpackJsonp=window.webpackJsonp||[]).push([[120],{384:function(t,s,l){"use strict";l.r(s);var r=l(10),a=Object(r.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"cms-concurrent-mark-sweep-并发标记清理"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#cms-concurrent-mark-sweep-并发标记清理"}},[t._v("#")]),t._v(" CMS (Concurrent Mark Sweep 并发标记清理)")]),t._v(" "),s("p",[s("code",[t._v("CMS")]),t._v("设计的目标就是获取最低停顿时间(stop the world停顿时间),它是基于"),s("strong",[t._v("标记-清除")]),t._v("算法实现的。")]),t._v(" "),s("h2",{attrs:{id:"cms-收集器的工作流程"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#cms-收集器的工作流程"}},[t._v("#")]),t._v(" CMS 收集器的工作流程")]),t._v(" "),s("ol",[s("li",[t._v("初始标记:只标记和GC Roots能直连的对象,速度快,会发生(stop the world)")]),t._v(" "),s("li",[t._v("并发标记:和应用线程并发执行,遍历初始标记阶段标记过的对象,标记这些对象的可达对象。")]),t._v(" "),s("li",[t._v("重新标记:由于并发标记是和应用线程是并发执行的,所以有些标记过的对象发生了变化。这个过程比初始标记用时长,但是比并发标记阶段用时短。会发生(stop the world)")]),t._v(" "),s("li",[t._v("并发清除:和应用线程一起运行。基于标记对象,直接清理对象。")])]),t._v(" "),s("h2",{attrs:{id:"cms-的缺点"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#cms-的缺点"}},[t._v("#")]),t._v(" CMS 的缺点")]),t._v(" "),s("ol",[s("li",[t._v("垃圾碎片问题\n"),s("ul",[s("li",[t._v("原因:由于CMS采用的是标记-清除算法,所以不可避免会有内存碎片问题。")]),t._v(" "),s("li",[t._v("解决:使用-XX:+CMSFullGCsBeforeCompaction=n,意思是在上次CMS并发GC执行过后,到底还要做多少Full GC才做压缩。默认是0,也就是说每次CMS GC顶不住了转入Full GC时都要压缩。")])])]),t._v(" "),s("li",[t._v("对 CPU 资源敏感\n"),s("ul",[s("li",[t._v("CMS 默认启动的回收线程数是（CPU数量+3）/4，当CPU不足4个时，CMS 对用户程序的影响可能变大")])])]),t._v(" "),s("li",[t._v("无法处理浮动垃圾\n"),s("ul",[s("li",[t._v("由于CMS 并发清除阶段用户线程还在运行着，伴随程序运行自然就回产生新的垃圾，这一部分垃圾（浮动垃圾）没有被标记，CMS 无法在当次收集中处理它们，只好留待下一次GC时在清理掉。")]),t._v(" "),s("li",[t._v("可能出现 “Concurrent Mode Failure” 失败而导致另一次Full GC 的产生。")])])])]),t._v(" "),s("h2",{attrs:{id:"为什么配置了cms-gc-却触发了full-gc"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#为什么配置了cms-gc-却触发了full-gc"}},[t._v("#")]),t._v(" 为什么配置了CMS GC,却触发了Full GC")]),t._v(" "),s("ol",[s("li",[t._v("大对象分配时,年轻代放不下,直接去老年代,结果老年代也放不下，（内存碎片问题：使用 标记-清除 算法的缺点）。")]),t._v(" "),s("li",[t._v("CMS GC失败，无法处理浮动垃圾，可能出现(Concurrent Mode Failure)失败而导致。")]),t._v(" "),s("li",[t._v("jmap -histo 人为执行了命令。")])]),t._v(" "),s("h2",{attrs:{id:"cms-gc日志分析"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#cms-gc日志分析"}},[t._v("#")]),t._v(" CMS GC日志分析 👍")]),t._v(" "),s("p",[t._v("![CMS GC日志分析](/img/java/CMS GC日志分析.png)")])])}),[],!1,null,null,null);s.default=a.exports}}]);