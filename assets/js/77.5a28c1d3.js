(window.webpackJsonp=window.webpackJsonp||[]).push([[77],{343:function(a,s,t){"use strict";t.r(s);var e=t(10),n=Object(e.a)({},(function(){var a=this,s=a._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[s("h1",{attrs:{id:"oom-å¼‚å¸¸åˆ†æ-jdk1-8"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#oom-å¼‚å¸¸åˆ†æ-jdk1-8"}},[a._v("#")]),a._v(" OOM å¼‚å¸¸åˆ†æ -JDK1.8")]),a._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[a._v("ç¤ºä¾‹é¡¹ç›®æºç ï¼š")]),a._v(" "),s("p",[a._v("ğŸ‘‰ "),s("a",{attrs:{href:"https://gitee.com/zhangquansheng/oom",target:"_blank",rel:"noopener noreferrer"}},[a._v("oom"),s("OutboundLink")],1)])]),a._v(" "),s("blockquote",[s("p",[a._v("ä»¥ä¸‹çŸ¥è¯†å…¨éƒ¨åŸºäºjdk1.8")])]),a._v(" "),s("p",[a._v("åœ¨Javaè™šæ‹Ÿæœºè§„èŒƒçš„æè¿°ä¸­ï¼Œé™¤äº†ç¨‹åºè®¡æ•°å™¨å¤–ï¼Œè™šæ‹Ÿæœºå†…å­˜çš„å…¶ä»–å‡ ä¸ªè¿è¡Œæ—¶åŒºåŸŸéƒ½æœ‰å¯èƒ½å‘ç”Ÿ OutOfMemoryErrorï¼ˆç®€ç§°OOMï¼‰å¼‚å¸¸çš„å¯èƒ½ã€‚\næœ¬æ¬¡åˆ†äº«çš„ç›®çš„æœ‰ä¸¤ä¸ªï¼š")]),a._v(" "),s("ul",[s("li",[a._v("ç¬¬ä¸€ï¼Œé€šè¿‡ä»£ç éªŒè¯Javaè™šæ‹Ÿæœºè§„èŒƒä¸­æè¿°çš„å„ä¸ªè¿è¡Œæ—¶åŒºåŸŸå­˜å‚¨çš„å†…å®¹ï¼›")]),a._v(" "),s("li",[a._v("ç¬¬äºŒï¼Œå¸Œæœ›å¤§å®¶åœ¨æ—¥å¸¸çš„å·¥ä½œä¸­é‡åˆ°å®é™…çš„å†…å­˜æº¢å‡ºå¼‚å¸¸æ—¶ï¼Œèƒ½å¦æ ¹æ®å¼‚å¸¸çš„ä¿¡æ¯å¿«é€Ÿåˆ¤æ–­æ˜¯å“ªä¸€ä¸ªåŒºåŸŸçš„å†…å­˜æº¢å‡ºï¼ŒçŸ¥é“åœ¨ä»€ä¹ˆæ ·çš„ä»£ç ä¼šå¯¼è‡´è¿™äº›åŒºåŸŸå†…å­˜æº¢å‡ºï¼Œä»¥åŠå‡ºç°è¿™äº›å¼‚å¸¸åæ”¹å¦‚ä½•å¤„ç†ã€‚")])]),a._v(" "),s("h2",{attrs:{id:"java-å †æº¢å‡º-java-lang-outofmemoryerror-java-heap-space"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#java-å †æº¢å‡º-java-lang-outofmemoryerror-java-heap-space"}},[a._v("#")]),a._v(" Java å †æº¢å‡ºï¼ˆjava.lang.OutOfMemoryError: java heap spaceï¼‰")]),a._v(" "),s("p",[a._v("Java å †ç”¨äºå­˜å‚¨å¯¹è±¡å®ä¾‹ï¼Œåªè¦ä¸æ–­åœ°åˆ›å»ºå¯¹è±¡ï¼Œå¹¶ä¸”ä¿è¯GC Rootsåˆ°å¯¹è±¡ä¹‹é—´æœ‰å¯è¾¾è·¯å¾„æ¥é¿å…åƒåœ¾å›æ”¶æœºåˆ¶æ¸…é™¤è¿™äº›å¯¹è±¡ï¼Œ é‚£ä¹ˆåœ¨å¯¹è±¡æ•°é‡åˆ°è¾¾å †æœ€å¤§å®¹é‡é™åˆ¶åå°±ä¼šäº§ç”Ÿå†…å­˜æº¢å‡ºå¼‚å¸¸ã€‚")]),a._v(" "),s("p",[a._v("é€šè¿‡-Xmså‚æ•°è®¾ç½®å †çš„æœ€å°å€¼ï¼Œå¹¶æŠŠå †çš„æœ€å¤§å€¼-Xmxè®¾ç½®ä¸ºä¸€æ ·ï¼Œé¿å…å †è‡ªåŠ¨æ‰©å±•")]),a._v(" "),s("p",[a._v("ä»£ç æ¸…å•ï¼š")]),a._v(" "),s("div",{staticClass:"language-java line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[a._v("    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("public")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Result")]),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Void")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("heapOOM")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("List")]),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("OOMObject")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v(" list "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("new")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("ArrayList")]),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("while")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token boolean"}},[a._v("true")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n            list"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("add")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("new")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("OOMObject")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br")])]),s("p",[a._v("å¯åŠ¨å‚æ•°ï¼š")]),a._v(" "),s("div",{staticClass:"language-shell script line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-Xms60m")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-Xmx60m")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-XX:MetaspaceSize")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("128m "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-XX:MaxMetaspaceSize")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("128m "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-XX:+UseG1GC")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-XX:MaxGCPauseMillis")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("200")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-Denv")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("dev -Deureka.client.register-with-eureka"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("false "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-Deureka.client.enabled")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("false\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("p",[a._v("è¿è¡Œç»“æœï¼š")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v('Exception in thread "http-nio-80-exec-9" java.lang.OutOfMemoryError: Java heap space\n2019-12-12 17:37:51,576 [NioBlockingSelector.BlockPoller-1] ERROR [org.apache.tomcat.util.net.NioBlockingSelector] DirectJDKLog.java:182 - \njava.lang.OutOfMemoryError: Java heap space\n2019-12-12 17:37:51,626 [http-nio-80-exec-8] ERROR [o.a.c.c.C.[.[localhost].[/].[dispatcherServlet]] DirectJDKLog.java:182 - Servlet.service() for servlet [dispatcherServlet] in context with path [] threw exception [Handler dispatch failed; nested exception is java.lang.OutOfMemoryError: Java heap space] with root cause\njava.lang.OutOfMemoryError: Java heap space\n')])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br")])]),s("p",[a._v("è§£å†³åŠæ³•ï¼Œä¸€èˆ¬çš„æ‰‹æ®µæ˜¯å…ˆé€šè¿‡å†…å­˜æ˜ åƒåˆ†æå·¥å…·ï¼ˆMATï¼‰å¯¹Dumpå‡ºæ¥çš„å †è½¬å‚¨å¿«ç…§è¿›è¡Œåˆ†æï¼Œé‡ç‚¹æ˜¯ç¡®è®¤å†…å­˜ä¸­çš„å¯¹è±¡æ˜¯å¦æ˜¯å¿…è¦çš„ï¼Œ ä¹Ÿå°±æ˜¯è¦å…ˆåˆ†æ¸…æ¥šæ˜¯å‡ºç°äº†å†…å­˜æ³„éœ²ï¼ˆMemory Leakï¼‰è¿˜æ˜¯å†…å­˜æº¢å‡ºï¼ˆMemory Overflowï¼‰")]),a._v(" "),s("p",[a._v("å¦‚æœæ˜¯å†…å­˜æ³„éœ²ï¼Œå¯è¿›ä¸€æ­¥é€šè¿‡å·¥å…·æŸ¥çœ‹æ³„éœ²å¯¹è±¡åˆ°GC Rootsçš„å¼•ç”¨é“¾ã€‚äºæ˜¯å°±èƒ½æ‰¾åˆ°æ³„éœ²å¯¹è±¡æ˜¯é€šè¿‡æ€æ ·çš„è·¯å¾„ä¸GC Rootsç›¸å…³è”ï¼Œ å¹¶å¯¼è‡´åƒåœ¾æ”¶é›†å™¨æ— æ³•è‡ªåŠ¨å›æ”¶å®ƒä»¬çš„ã€‚æŒæ¡äº†æ³„éœ²å¯¹è±¡çš„ç±»å‹ä¿¡æ¯ä»¥åŠGC Roots å¼•ç”¨é“¾çš„ä¿¡æ¯ï¼Œå°±å¯ä»¥æ¯”è¾ƒå‡†ç¡®åœ°å®šä½å‡ºæ³„éœ²ä»£ç çš„ä½ç½®ã€‚")]),a._v(" "),s("p",[a._v("å¦‚æœä¸å­˜åœ¨æ³„éœ²ï¼Œé‚£å°±åº”å½“æ£€æŸ¥è™šæ‹Ÿæœºçš„å †å‚æ•°ï¼ˆ-Xms -Xmxï¼‰ï¼Œä¸æœºå™¨ç‰©ç†å†…å­˜å¯¹æ¯”çœ‹æ˜¯å¦è¿˜å¯ä»¥è°ƒå¤§ä¸€ç‚¹ï¼Œä¹Ÿå¯ä»¥ä»ä»£ç æ£€æŸ¥æ˜¯å¦å­˜åœ¨æŸäº›å¯¹è±¡å£°æ˜å‘¨æœŸè¿‡é•¿ï¼ŒæŒæœ‰çŠ¶æ€æ—¶é—´è¿‡é•¿çš„æƒ…å†µï¼Œå°è¯•å‡å°‘ç¨‹åºè¿è¡ŒæœŸçš„å†…å­˜æ¶ˆè€—ã€‚")]),a._v(" "),s("h2",{attrs:{id:"è™šæ‹Ÿæœºæ ˆå’Œæœ¬åœ°æ–¹æ³•æ ˆæº¢å‡º"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#è™šæ‹Ÿæœºæ ˆå’Œæœ¬åœ°æ–¹æ³•æ ˆæº¢å‡º"}},[a._v("#")]),a._v(" è™šæ‹Ÿæœºæ ˆå’Œæœ¬åœ°æ–¹æ³•æ ˆæº¢å‡º")]),a._v(" "),s("p",[a._v("ç”±äºåœ¨HotSpotè™šæ‹Ÿæœºä¸­å¹¶ä¸åŒºåˆ†è™šæ‹Ÿæœºæ ˆå’Œæœ¬åœ°æ–¹æ³•æ ˆï¼Œå› æ­¤ï¼Œå¯¹äºHotSpotæ¥è¯´ï¼Œè™½ç„¶-Xosså‚æ•°ï¼ˆè¿™æ˜¯æœ¬åœ°æ–¹æ³•æ ˆå¤§å°ï¼‰å­˜åœ¨ï¼Œä½†æ˜¯å®é™…ä¸Šæ— æ•ˆçš„ï¼Œ æ ˆå®¹é‡åªç”±-Xsså‚æ•°è®¾å®šã€‚å…³äºè™šæ‹Ÿæœºæ ˆå’Œæœ¬åœ°æ–¹æ³•æ ˆï¼Œåœ¨Javaè™šæ‹Ÿæœºè§„èŒƒä¸­æè¿°äº†ä¸¤ç§å¼‚å¸¸ï¼š")]),a._v(" "),s("ul",[s("li",[a._v("å¦‚æœçº¿ç¨‹è¯·æ±‚çš„æ ˆæ·±åº¦å¤§äºè™šæ‹Ÿæœºæ‰€å…è®¸çš„æœ€å¤§æ·±åº¦ï¼Œå°†æŠ›å‡ºStackOverFlowErrorå¼‚å¸¸ã€‚")]),a._v(" "),s("li",[a._v("å¦‚æœè™šæ‹Ÿæœºåœ¨æ‰©å±•æ ˆæ—¶æ— æ³•ç”³è¯·è¶³å¤Ÿçš„å†…å­˜ç©ºé—´ï¼Œåˆ™æŠ›å‡ºOutOfMemoryErrorå¼‚å¸¸ã€‚")])]),a._v(" "),s("p",[a._v("æµ‹è¯•ä»£ç :")]),a._v(" "),s("div",{staticClass:"language-java line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("public")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("class")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("JavaVMStackSOF")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("private")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("int")]),a._v(" stackLength "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("public")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("void")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("stackLeak")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n        stackLength"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("++")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("stackLeak")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br"),s("span",{staticClass:"line-number"},[a._v("10")]),s("br")])]),s("p",[a._v("è¿è¡Œç»“æœï¼š")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("2019-12-13 11:01:00,511 [http-nio-80-exec-9] ERROR [o.a.c.c.C.[.[localhost].[/].[dispatcherServlet]] DirectJDKLog.java:182 - Servlet.service() for servlet [dispatcherServlet] in context with path [] threw exception [Handler dispatch failed; nested exception is java.lang.StackOverflowError] with root cause\njava.lang.StackOverflowError: null\n\tat com.gaodun.ts.oom.JavaVMStackSOF.stackLeak(JavaVMStackSOF.java:15)\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br")])]),s("p",[a._v("åœ¨å•çº¿ç¨‹ä¸­ï¼Œç”±äºæ ˆå¸§å¤ªå¤§ï¼ˆè™šæ‹Ÿæœºæ ˆå®¹é‡å¤ªå°ï¼‰ï¼Œå½“å†…å­˜æ— æ³•åˆ†é…çš„æ—¶å€™ï¼ŒæŠ›å‡º StackOverflowError å¼‚å¸¸ã€‚")]),a._v(" "),s("p",[a._v("ä¹Ÿå¯ä»¥ä½¿ç”¨-Xsså‚æ•°å‡å°‘æ ˆå†…å­˜ï¼Œä¹Ÿæ˜¯å¯ä»¥æŠ›å‡º StackOverflowError å¼‚å¸¸ã€‚")]),a._v(" "),s("h2",{attrs:{id:"å…ƒç©ºé—´æº¢å‡º"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#å…ƒç©ºé—´æº¢å‡º"}},[a._v("#")]),a._v(" å…ƒç©ºé—´æº¢å‡º")]),a._v(" "),s("p",[a._v("å…ƒç©ºé—´çš„æœ¬è´¨å’Œæ°¸ä¹…ä»£ç±»ä¼¼ï¼Œéƒ½æ˜¯å¯¹JVMè§„èŒƒä¸­æ–¹æ³•åŒºçš„å®ç°ã€‚ä¸è¿‡å…ƒç©ºé—´ä¸æ°¸ä¹…ä»£ä¹‹é—´æœ€å¤§çš„åŒºåˆ«åœ¨äºï¼š å…ƒç©ºé—´å¹¶ä¸åœ¨è™šæ‹Ÿæœºä¸­ï¼Œè€Œæ˜¯ä½¿ç”¨æœ¬åœ°å†…å­˜ã€‚å› æ­¤ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œå…ƒç©ºé—´çš„å¤§å°ä»…å—æœ¬åœ°å†…å­˜é™åˆ¶ï¼Œ ä½†å¯ä»¥é€šè¿‡ä»¥ä¸‹å‚æ•°æ¥æŒ‡å®šå…ƒç©ºé—´çš„å¤§å°ï¼š")]),a._v(" "),s("ul",[s("li",[a._v("-XX:MetaspaceSizeï¼Œåˆå§‹ç©ºé—´å¤§å°ï¼Œè¾¾åˆ°è¯¥å€¼å°±ä¼šè§¦å‘åƒåœ¾æ”¶é›†è¿›è¡Œç±»å‹å¸è½½ï¼ŒåŒæ—¶GCä¼šå¯¹è¯¥å€¼è¿›è¡Œè°ƒæ•´ï¼šå¦‚æœé‡Šæ”¾äº†å¤§é‡çš„ç©ºé—´ï¼Œå°±é€‚å½“é™ä½è¯¥å€¼ï¼›å¦‚æœé‡Šæ”¾äº†å¾ˆå°‘çš„ç©ºé—´ï¼Œé‚£ä¹ˆåœ¨ä¸è¶…è¿‡MaxMetaspaceSizeæ—¶ï¼Œé€‚å½“æé«˜è¯¥å€¼ã€‚")]),a._v(" "),s("li",[a._v("-XX:MaxMetaspaceSizeï¼Œæœ€å¤§ç©ºé—´ï¼Œé»˜è®¤æ˜¯æ²¡æœ‰é™åˆ¶çš„ã€‚")])]),a._v(" "),s("p",[a._v("æµ‹è¯•ä»£ç :")]),a._v(" "),s("div",{staticClass:"language-java line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[a._v("        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("while")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token boolean"}},[a._v("true")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n            "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Enhancer")]),a._v(" enhancer "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("new")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Enhancer")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n            enhancer"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("setSuperclass")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("OOMObject")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("class")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n            enhancer"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("setUseCache")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token boolean"}},[a._v("false")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n            enhancer"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("setCallback")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("new")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("MethodInterceptor")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n                "),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[a._v("@Override")]),a._v("\n                "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("public")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Object")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("intercept")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Object")]),a._v(" o"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Method")]),a._v(" method"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Object")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v(" objects"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("MethodProxy")]),a._v(" methodProxy"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("throws")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Throwable")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n                    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("return")]),a._v(" methodProxy"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("invokeSuper")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("o"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" objects"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n                "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n            enhancer"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("create")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br"),s("span",{staticClass:"line-number"},[a._v("10")]),s("br"),s("span",{staticClass:"line-number"},[a._v("11")]),s("br"),s("span",{staticClass:"line-number"},[a._v("12")]),s("br")])]),s("p",[a._v("å¯åŠ¨å‚æ•°ï¼š -Xms1024m -Xmx1024m -XX:MetaspaceSize=128m -XX:MaxMetaspaceSize=128m -XX:+UseG1GC -XX:MaxGCPauseMillis=200 -Denv=dev -Deureka.client.register-with-eureka=false -Deureka.client.enabled=false")]),a._v(" "),s("p",[s("img",{attrs:{src:"/img/oom/metaspace.png",alt:"metaspace"}})]),a._v(" "),s("p",[a._v("è¿è¡Œç»“æœï¼š")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v('Exception in thread "SimplePauseDetectorThread_0" Exception in thread "http-nio-80-exec-1" java.lang.OutOfMemoryError: Metaspace\njava.lang.OutOfMemoryError: Metaspace\n')])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br")])]),s("blockquote",[s("ul",[s("li",[a._v("Java7ï¼Œå°†å¸¸é‡æ± æ˜¯å­˜æ”¾åˆ°äº†å †ä¸­ï¼Œå¸¸é‡æ± å°±ç›¸å½“äºæ˜¯åœ¨æ°¸ä¹…ä»£ä¸­ï¼Œæ‰€ä»¥æ°¸ä¹…ä»£å­˜æ”¾åœ¨å †ä¸­ã€‚")]),a._v(" "),s("li",[a._v("Java8ï¼Œå–æ¶ˆäº†æ•´ä¸ªæ°¸ä¹…ä»£åŒºåŸŸï¼Œå–è€Œä»£ä¹‹çš„æ˜¯å…ƒç©ºé—´ã€‚æ²¡æœ‰å†å¯¹å¸¸é‡æ± è¿›è¡Œè°ƒæ•´ã€‚")])])]),a._v(" "),s("h2",{attrs:{id:"æœ¬æœºç›´æ¥å†…å­˜æº¢å‡º"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#æœ¬æœºç›´æ¥å†…å­˜æº¢å‡º"}},[a._v("#")]),a._v(" æœ¬æœºç›´æ¥å†…å­˜æº¢å‡º")]),a._v(" "),s("p",[a._v("DirectMemory å®¹é‡å¯é€šè¿‡-XX:MaxDirectMemorySizeæŒ‡å®šï¼Œå¦‚æœä¸æŒ‡å®šï¼Œåˆ™é»˜è®¤ä¸Javaå †æœ€å¤§å€¼ï¼ˆ-XmxæŒ‡å®šï¼‰ä¸€æ ·")]),a._v(" "),s("p",[a._v("ç›´æ¥é€šè¿‡åå°„è·å–Unsafeå®ä¾‹è¿›è¡Œå†…å­˜åˆ†é…ï¼ˆUnsafeç±»çš„getUnsafe()æ–¹æ³•é™åˆ¶äº†åªæœ‰å¼•å¯¼ç±»åŠ è½½å™¨æ‰ä¼šè¿”å›å®ä¾‹ï¼Œ\nä¹Ÿå°±æ˜¯è®¾è®¡è€…å¸Œæœ›åªæœ‰rt.jarä¸­çš„ç±»æ‰èƒ½ä½¿ç”¨Unsafeçš„åŠŸèƒ½ï¼‰ã€‚\næµ‹è¯•ä»£ç :")]),a._v(" "),s("div",{staticClass:"language-java line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[a._v("        "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Field")]),a._v(" unsafeField "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Unsafe")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("class")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("getDeclaredFields")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n        unsafeField"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("setAccessible")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token boolean"}},[a._v("true")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Unsafe")]),a._v(" unsafe "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Unsafe")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" unsafeField"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("get")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("null")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("while")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token boolean"}},[a._v("true")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n            "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// 1M")]),a._v("\n            unsafe"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("allocateMemory")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1024")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("*")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1024")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br")])]),s("p",[a._v("å¯åŠ¨å‚æ•°ï¼š-Xms100m -Xmx100m  -XX:MaxDirectMemorySize=100m -XX:MetaspaceSize=128m -XX:MaxMetaspaceSize=128m -XX:+UseG1GC -XX:MaxGCPauseMillis=200 -Denv=dev -Deureka.client.register-with-eureka=false -Deureka.client.enabled=false")]),a._v(" "),s("p",[a._v("è¿è¡Œç»“æœï¼š")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("2019-12-13 13:12:32,547 [http-nio-80-exec-1] ERROR [o.a.c.c.C.[.[localhost].[/].[dispatcherServlet]] DirectJDKLog.java:182 - Servlet.service() for servlet [dispatcherServlet] in context with path [] threw exception [Handler dispatch failed; nested exception is java.lang.OutOfMemoryError] with root cause\njava.lang.OutOfMemoryError: null\n\tat sun.misc.Unsafe.allocateMemory(Native Method)\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br")])]),s("p",[a._v("ç”±äºç›´æ¥å†…å­˜æº¢å‡ºï¼Œä¸€ä¸ªæ˜æ˜¾çš„ç‰¹å¾æ˜¯åœ¨Heap Dump æ–‡ä»¶ä¸­ä¸ä¼šçœ‹åˆ°æ˜æ˜¾çš„å¼‚å¸¸ï¼Œå¦‚æœä½ å‘ç°OOMä¹‹åDumpæ–‡ä»¶å¾ˆå°ï¼Œ è€Œç¨‹åºä¸­æœ‰ç›´æ¥æˆ–è€…é—´æ¥ä½¿ç”¨äº†NIOï¼Œå¯ä»¥è€ƒè™‘ä¸€ä¸‹æ˜¯ä¸æ˜¯è¿™æ–¹é¢çš„åŸå› ã€‚")]),a._v(" "),s("h2",{attrs:{id:"é—®é¢˜å»¶ä¼¸"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#é—®é¢˜å»¶ä¼¸"}},[a._v("#")]),a._v(" é—®é¢˜å»¶ä¼¸")]),a._v(" "),s("ul",[s("li",[a._v("JVM è¿è¡Œæ—¶æ•°æ®åŒºåŸŸ&JVMå†…å­˜æ¨¡å‹\n"),s("blockquote",[s("ul",[s("li",[a._v("ä»‹ç»ä¸‹ Java å†…å­˜åŒºåŸŸï¼ˆè¿è¡Œæ—¶æ•°æ®åŒºï¼‰")]),a._v(" "),s("li",[a._v("Java å¯¹è±¡çš„åˆ›å»ºè¿‡ç¨‹ï¼ˆäº”æ­¥ï¼Œå»ºè®®èƒ½é»˜å†™å‡ºæ¥å¹¶ä¸”è¦çŸ¥é“æ¯ä¸€æ­¥è™šæ‹Ÿæœºåšäº†ä»€ä¹ˆï¼‰")]),a._v(" "),s("li",[a._v("å¯¹è±¡çš„è®¿é—®å®šä½çš„ä¸¤ç§æ–¹å¼ï¼ˆå¥æŸ„å’Œç›´æ¥æŒ‡é’ˆä¸¤ç§æ–¹å¼ï¼‰")]),a._v(" "),s("li",[a._v("æ–¹æ³•åŒºå’Œæ°¸ä¹…ä»£çš„å…³ç³»")]),a._v(" "),s("li",[a._v("ä¸ºä»€ä¹ˆè¦å°†æ°¸ä¹…ä»£ (PermGen) æ›¿æ¢ä¸ºå…ƒç©ºé—´ (MetaSpace) å‘¢?")]),a._v(" "),s("li",[a._v("String ç±»å’Œå¸¸é‡æ± ")]),a._v(" "),s("li",[a._v("8ç§åŸºæœ¬ç±»å‹çš„åŒ…è£…ç±»å’Œå¸¸é‡æ± ")])])])]),a._v(" "),s("li",[a._v("OOMåˆ†æ")]),a._v(" "),s("li",[a._v("JVMåƒåœ¾æ”¶é›†å™¨æœ‰å“ªäº›ï¼Œåˆ†åˆ«å¯¹åº”çš„åƒåœ¾æ”¶é›†ç®—æ³•æ˜¯æ€æ ·çš„")]),a._v(" "),s("li",[a._v("JVMè°ƒä¼˜ç»éªŒ")])]),a._v(" "),s("hr"),a._v(" "),s("p",[s("strong",[a._v("å‚è€ƒæ–‡æ¡£")])]),a._v(" "),s("ul",[s("li",[a._v("ã€Šæ·±å…¥ç†è§£Javaè™šæ‹Ÿæœºã€‹")])])])}),[],!1,null,null,null);s.default=n.exports}}]);