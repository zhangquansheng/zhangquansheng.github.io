(window.webpackJsonp=window.webpackJsonp||[]).push([[144],{411:function(e,t,a){"use strict";a.r(t);var s=a(10),_=Object(s.a)({},(function(){var e=this,t=e._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[t("h1",{attrs:{id:"为什么-mysql-不建议使用-delete-删除数据-truncate-相关命令用法"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#为什么-mysql-不建议使用-delete-删除数据-truncate-相关命令用法"}},[e._v("#")]),e._v(" 为什么 MySQL 不建议使用 delete 删除数据？ & Truncate 相关命令用法")]),e._v(" "),t("p",[t("code",[e._v("delete")]),e._v("物理删除其实不能释放磁盘空间，而且会产生大量的碎片，导致索引频繁"),t("strong",[e._v("分裂")]),e._v("，影响"),t("code",[e._v("SQL")]),e._v("执行计划的稳定性；\n同时在碎片回收时，会耗用大量的"),t("code",[e._v("CPU")]),e._v("，磁盘空间，影响表上正常的"),t("code",[e._v("DML")]),e._v("操作。")]),e._v(" "),t("p",[e._v("我们在业务代码中，建议做逻辑标记删除，避免物理删除。")]),e._v(" "),t("h2",{attrs:{id:"页合并-页分裂"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#页合并-页分裂"}},[e._v("#")]),e._v(" 页合并 & 页分裂")]),e._v(" "),t("p",[t("a",{attrs:{href:"https://www.cs.usfca.edu/~galles/visualization/BPlusTree.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("B+ Trees"),t("OutboundLink")],1),e._v("动态演示。")]),e._v(" "),t("p",[t("code",[e._v("MySQL")]),e._v("物理删除记录时，不会实际删除这条记录，而是将这条"),t("strong",[e._v("记录标记为已删除")]),e._v("，并记录数据页的可回收空间阈值。\n当数据页的可回收空间阈值等于"),t("code",[e._v("MERGE_THRESHOLD")]),e._v("（默认为页面大小的"),t("code",[e._v("50％")]),e._v("）时，"),t("code",[e._v("InnoDB")]),e._v("开始寻找最近的页面（"),t("code",[e._v("NEXT")]),e._v("和"),t("code",[e._v("PREVIOUS")]),e._v("），以查看是否有机会合并这数据页（"),t("strong",[e._v("碎片回收")]),e._v("）。")]),e._v(" "),t("p",[e._v("在"),t("code",[e._v("B+Tree")]),e._v("中，所有的叶子节点都是按键值的大小顺序存放在同一层的叶子节点上，由各叶子节点指针双向链表关联起来。\n如果你自定义了主键索引，且这个主键索引不是自增的，那么随着数据的写入，导致要写入数据页已满且后面一个数据页中数据页也满，无法正常写入，触发页分裂的逻辑。")]),e._v(" "),t("p",[e._v("页分裂的"),t("code",[e._v("B+Tree")]),e._v("实际上在物理上可能是乱序的，并且大多数情况下是不同程度的物理上乱序。这就是为啥，我们要求"),t("strong",[e._v("使用自增长"),t("code",[e._v("ID")]),e._v("的原因")]),e._v("。")]),e._v(" "),t("h2",{attrs:{id:"drop-table-ddl"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#drop-table-ddl"}},[e._v("#")]),e._v(" DROP TABLE (DDL)")]),e._v(" "),t("p",[e._v("使用"),t("code",[e._v("DROP TABLE")]),e._v("命令可以快速删除MySQL中的数据表。该命令的语法如下：")]),e._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("DROP")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("TABLE")]),e._v(" table_name1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" table_name2"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br")])]),t("h2",{attrs:{id:"truncate-table-ddl"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#truncate-table-ddl"}},[e._v("#")]),e._v(" TRUNCATE TABLE (DDL)")]),e._v(" "),t("p",[t("code",[e._v("TRUNCATE TABLE")]),e._v("命令用于清空"),t("code",[e._v("MySQL")]),e._v("中的数据表中的数据，")]),e._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("TRUNCATE")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("TABLE")]),e._v(" table_name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("TRUNCATE")]),e._v(" table_name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br")])]),t("h2",{attrs:{id:"delete-from-dml"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#delete-from-dml"}},[e._v("#")]),e._v(" DELETE FROM (DML)")]),e._v(" "),t("p",[e._v("DELETE FROM命令用于删除表中的数据。该命令仅删除表中的记录，如果您需要删除特定的行，可以使用WHERE子句。该命令的语法如下：")]),e._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("DELETE")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("FROM")]),e._v(" table_name "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("WHERE")]),e._v(" condition"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br")])]),t("h2",{attrs:{id:"drop-database-ddl"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#drop-database-ddl"}},[e._v("#")]),e._v(" DROP DATABASE (DDL)")]),e._v(" "),t("p",[e._v("可以使用"),t("code",[e._v("DROP DATABASE")]),e._v("删除整个数据库。")]),e._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("DROP")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("DATABASE")]),e._v(" database_name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br")])]),t("h2",{attrs:{id:"truncate-与-delete-from-区别"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#truncate-与-delete-from-区别"}},[e._v("#")]),e._v(" TRUNCATE 与 DELETE FROM 区别")]),e._v(" "),t("ol",[t("li",[t("code",[e._v("TRUNCATE TABLE")]),e._v("在功能上与不带"),t("code",[e._v("WHERE")]),e._v("子句的"),t("code",[e._v("DELETE")]),e._v("语句相同：二者均删除表中的全部行。但"),t("code",[e._v("TRUNCATE TABLE")]),e._v("比"),t("code",[e._v("DELETE")]),e._v("速度快，且使用的系统和事务日志资源少。")]),e._v(" "),t("li",[t("code",[e._v("DELETE")]),e._v("语句每次删除一行，并在事务日志中为所删除的每行记录一项。"),t("code",[e._v("TRUNCATE TABLE")]),e._v("通过释放存储表数据所用的数据页来删除数据，并且只在事务日志中记录页的释放。")]),e._v(" "),t("li",[t("code",[e._v("TRUNCATE TABLE")]),e._v("删除表中的所有行，但表结构及其列、约束、索引等保持不变，并且能针对具有自动递增值的字段，做计数重置归零重新计算的作用。")]),e._v(" "),t("li",[e._v("对于由"),t("code",[e._v("FOREIGN KEY")]),e._v("约束引用的表，不能使用"),t("code",[e._v("TRUNCATE TABLE")]),e._v("，而应使用不带"),t("code",[e._v("WHERE")]),e._v("子句的"),t("code",[e._v("DELETE")]),e._v("语句。由于"),t("code",[e._v("TRUNCATE TABLE")]),e._v("不记录在日志中，所以它不能激活触发器。")]),e._v(" "),t("li",[t("code",[e._v("TRUNCATE TABLE")]),e._v("不能用于参与了索引视图的表。")]),e._v(" "),t("li",[e._v("对用"),t("code",[e._v("TRUNCATE TABLE")]),e._v("删除数据的表上增加数据时，要使用"),t("code",[e._v("UPDATE STATISTICS")]),e._v("来维护索引信息。")]),e._v(" "),t("li",[e._v("如果有"),t("code",[e._v("ROLLBACK")]),e._v("语句，"),t("code",[e._v("DELETE")]),e._v("操作将被撤销，但"),t("code",[e._v("TRUNCATE")]),e._v("不会撤销。")]),e._v(" "),t("li",[e._v("执行"),t("code",[e._v("TRUNCATE TABLE")]),e._v("需要"),t("code",[e._v("DROP")]),e._v("权限。")])]),e._v(" "),t("hr"),e._v(" "),t("p",[t("strong",[e._v("参考文档")])]),e._v(" "),t("ul",[t("li",[t("a",{attrs:{href:"https://mp.weixin.qq.com/s/7dpNkLaglIyb_9DKdH43eQ",target:"_blank",rel:"noopener noreferrer"}},[e._v("小弟问我：为什么MySQL不建议使用delete删除数据？"),t("OutboundLink")],1)]),e._v(" "),t("li",[t("a",{attrs:{href:"https://www.percona.com/blog/2017/04/10/innodb-page-merging-and-page-splitting/",target:"_blank",rel:"noopener noreferrer"}},[e._v("InnoDB Page Merging and Page Splitting"),t("OutboundLink")],1)])])])}),[],!1,null,null,null);t.default=_.exports}}]);