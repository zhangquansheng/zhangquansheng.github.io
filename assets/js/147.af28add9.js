(window.webpackJsonp=window.webpackJsonp||[]).push([[147],{410:function(_,t,a){"use strict";a.r(t);var v=a(10),s=Object(v.a)({},(function(){var _=this,t=_._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":_.$parent.slotKey}},[t("h1",{attrs:{id:"mysql-索引失效"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#mysql-索引失效"}},[_._v("#")]),_._v(" MySQL 索引失效")]),_._v(" "),t("h2",{attrs:{id:"_1-隐式的类型转换-索引失效"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-隐式的类型转换-索引失效"}},[_._v("#")]),_._v(" 1. 隐式的类型转换，索引失效")]),_._v(" "),t("blockquote",[t("p",[_._v("MySQL会做隐式的类型转换，会导致索引会失效。常见的字符型字段传入数字")])]),_._v(" "),t("h2",{attrs:{id:"_2-查询条件包含-or-索引可能失效"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-查询条件包含-or-索引可能失效"}},[_._v("#")]),_._v(" 2. 查询条件包含 or，索引"),t("code",[_._v("可能")]),_._v("失效")]),_._v(" "),t("blockquote",[t("p",[_._v("遇到不走索引的时候，考虑拆开两条SQL")])]),_._v(" "),t("h2",{attrs:{id:"_3-like通配符可能导致索引失效"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-like通配符可能导致索引失效"}},[_._v("#")]),_._v(" 3. like通配符可能导致索引失效")]),_._v(" "),t("h2",{attrs:{id:"_4-查询条件不满足联合索引的最左匹配原则"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-查询条件不满足联合索引的最左匹配原则"}},[_._v("#")]),_._v(" 4. 查询条件不满足联合索引的最左匹配原则")]),_._v(" "),t("blockquote",[t("p",[_._v("MySQl建立联合索引时，会遵循最左前缀匹配的原则，即最左优先。如果你建立一个（a,b,c）\n的联合索引，相当于建立了(a)、(a,b)、(a,b,c)三个索引。在联合索引中，查询条件满足最左匹配原则时，索引才正常生效。")])]),_._v(" "),t("h2",{attrs:{id:"_5-在索引列上使用mysql的内置函数"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5-在索引列上使用mysql的内置函数"}},[_._v("#")]),_._v(" 5. 在索引列上使用mysql的内置函数")]),_._v(" "),t("h2",{attrs:{id:"_6-对索引进行列运算-如-、-、-、-索引不生效"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_6-对索引进行列运算-如-、-、-、-索引不生效"}},[_._v("#")]),_._v(" 6. 对索引进行列运算（如，+、-、*、/）,索引不生效")]),_._v(" "),t("p",[_._v("不可以对索引列进行运算，可以把运算放到右边或者直接在代码中处理好，再传参进去。")]),_._v(" "),t("h2",{attrs:{id:"_7-索引字段上使用-或者-索引可能失效"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_7-索引字段上使用-或者-索引可能失效"}},[_._v("#")]),_._v(" 7. 索引字段上使用（！= 或者 < >），索引"),t("code",[_._v("可能")]),_._v("失效")]),_._v(" "),t("p",[_._v("MySQL优化器觉得即使走索引，还是需要扫描很多行，它觉得不划算，不如直接不走索引。平时我们用"),t("code",[_._v("！=")]),_._v(" 或者"),t("code",[_._v("not in")]),_._v("的时候，需要注意")]),_._v(" "),t("h2",{attrs:{id:"_8-索引字段上使用is-null-is-not-null-索引可能失效"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_8-索引字段上使用is-null-is-not-null-索引可能失效"}},[_._v("#")]),_._v(" 8. 索引字段上使用is null， is not null，索引"),t("code",[_._v("可能")]),_._v("失效")]),_._v(" "),t("p",[_._v("很多时候是因为数据量的问题，导致MySQL优化器放弃走索引。我们平时用explain分析SQL的时候，如果type=range时要注意一下，因为这个可能因为数据量的问题，导致索引无效。")]),_._v(" "),t("h2",{attrs:{id:"_9-左右连接-关联的字段编码格式不一样"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_9-左右连接-关联的字段编码格式不一样"}},[_._v("#")]),_._v(" 9. 左右连接，关联的字段编码格式不一样")]),_._v(" "),t("p",[_._v("字段编码有些是utf8mb4，有些为为utf8。大家在做表关联时，注意一下关联字段的编码问题")]),_._v(" "),t("h2",{attrs:{id:"_10-优化器选错了索引"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_10-优化器选错了索引"}},[_._v("#")]),_._v(" 10. 优化器选错了索引")]),_._v(" "),t("ul",[t("li",[_._v("1）使用force index 强行选择某个索引")]),_._v(" "),t("li",[_._v("2）修改SQL，引导它使用我们期望的索引")]),_._v(" "),t("li",[_._v("3）优化业务逻辑，优化索引；新建一个更合适的索引，或者删除误用的索引")])]),_._v(" "),t("h2",{attrs:{id:"mysql-索引在-in-条件下失效的原因"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#mysql-索引在-in-条件下失效的原因"}},[_._v("#")]),_._v(" MySQL 索引在 in 条件下失效的原因")]),_._v(" "),t("p",[_._v("首先我们看"),t("code",[_._v("IN")]),_._v("索引失效的情况：\n"),t("img",{attrs:{src:"/img/mysql/in-1.jpg",alt:"in-1"}}),_._v("\n从执行计划看到"),t("code",[_._v("type=ALL，Extra=Using where")]),_._v("走的是全表扫描，索引失效。")]),_._v(" "),t("p",[_._v("那么"),t("code",[_._v("IN")]),_._v("索引失效的情况分为以下几种（其他的索引失效，也可以参考）")]),_._v(" "),t("ol",[t("li",[_._v("类型不匹配，当索引字段是字符串时，查询的参数也必须是字符串。")]),_._v(" "),t("li",[_._v("数据量\n"),t("ul",[t("li",[_._v("如果数据量很小，"),t("code",[_._v("MySQL")]),_._v("会认为扫描全表比使用索引快，自然不会走索引（优化器）")]),_._v(" "),t("li",[_._v("如果查询结果数据量很多，"),t("code",[_._v("MySQL")]),_._v("也不会使用索引。\n"),t("strong",[_._v("可以通过加上"),t("code",[_._v("limit")]),_._v("来解决这个问题")]),_._v("。")])])]),_._v(" "),t("li",[_._v("排序问题")])]),_._v(" "),t("p",[_._v("通过以上的分析，上面的索引失效情况可以通过加上"),t("code",[_._v("limit")]),_._v("来解决，如下图:\n"),t("img",{attrs:{src:"/img/mysql/in-2.jpg",alt:"in-2"}})])])}),[],!1,null,null,null);t.default=s.exports}}]);