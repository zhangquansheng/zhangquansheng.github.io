(window.webpackJsonp=window.webpackJsonp||[]).push([[154],{420:function(_,v,t){"use strict";t.r(v);var o=t(10),e=Object(o.a)({},(function(){var _=this,v=_._self._c;return v("ContentSlotsDistributor",{attrs:{"slot-key":_.$parent.slotKey}},[v("h1",{attrs:{id:"äº‹åŠ¡"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#äº‹åŠ¡"}},[_._v("#")]),_._v(" äº‹åŠ¡")]),_._v(" "),v("p",[v("a",{attrs:{href:"https://dev.mysql.com/doc/refman/5.7/en/mysql-acid.html",target:"_blank",rel:"noopener noreferrer"}},[_._v("å®˜æ–¹æ–‡æ¡£"),v("OutboundLink")],1)]),_._v(" "),v("h2",{attrs:{id:"æ¦‚è¿°"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#æ¦‚è¿°"}},[_._v("#")]),_._v(" æ¦‚è¿°")]),_._v(" "),v("p",[_._v("æ•°æ®åº“"),v("strong",[_._v("äº‹åŠ¡")]),_._v("æ˜¯è®¿é—®å¹¶å¯èƒ½æ“ä½œå„ç§æ•°æ®é¡¹çš„ä¸€ä¸ªæ•°æ®åº“æ“ä½œåºåˆ—ï¼Œè¿™äº›æ“ä½œ"),v("strong",[_._v("è¦ä¹ˆå…¨éƒ¨æ‰§è¡Œ,è¦ä¹ˆå…¨éƒ¨ä¸æ‰§è¡Œ")]),_._v("ï¼Œæ˜¯ä¸€ä¸ªä¸å¯åˆ†å‰²çš„å·¥ä½œå•ä½ã€‚")]),_._v(" "),v("p",[_._v("ä¸€èˆ¬æ¥è¯´ï¼Œæ•°æ®åº“äº‹åŠ¡å…·æœ‰"),v("strong",[_._v("ACID")]),_._v("è¿™4ä¸ª"),v("strong",[_._v("ç‰¹æ€§")]),_._v("ï¼š")]),_._v(" "),v("ul",[v("li",[v("strong",[_._v("åŸå­æ€§ï¼ˆAtomicityï¼‰ï¼š")]),_._v("  ä¸€ä¸ªäº‹åŠ¡ï¼ˆ"),v("code",[_._v("transaction")]),_._v("ï¼‰ä¸­çš„æ‰€æœ‰æ“ä½œï¼Œè¦ä¹ˆå…¨éƒ¨å®Œæˆï¼Œè¦ä¹ˆå…¨éƒ¨ä¸å®Œæˆï¼Œä¸ä¼šç»“æŸåœ¨ä¸­é—´æŸä¸ªç¯èŠ‚ã€‚äº‹åŠ¡åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯ï¼Œä¼šè¢«å›æ»šï¼ˆ"),v("code",[_._v("Rollback")]),_._v("ï¼‰åˆ°äº‹åŠ¡å¼€å§‹å‰çš„çŠ¶æ€ï¼Œå°±åƒè¿™ä¸ªäº‹åŠ¡ä»æ¥æ²¡æœ‰æ‰§è¡Œè¿‡ä¸€æ ·ã€‚")]),_._v(" "),v("li",[v("strong",[_._v("ä¸€è‡´æ€§ï¼ˆConsistencyï¼‰ï¼š")]),_._v("  åœ¨äº‹åŠ¡å¼€å§‹ä¹‹å‰å’Œäº‹åŠ¡ç»“æŸä»¥åï¼Œæ•°æ®åº“çš„å®Œæ•´æ€§æ²¡æœ‰è¢«ç ´åã€‚")]),_._v(" "),v("li",[v("strong",[_._v("éš”ç¦»æ€§ï¼ˆIsolationï¼‰ï¼š")]),_._v("  æ•°æ®åº“å…è®¸å¤šä¸ªå¹¶å‘äº‹åŠ¡åŒæ—¶å¯¹å…¶æ•°æ®è¿›è¡Œè¯»å†™å’Œä¿®æ”¹çš„èƒ½åŠ›ï¼Œéš”ç¦»æ€§å¯ä»¥é˜²æ­¢å¤šä¸ªäº‹åŠ¡å¹¶å‘æ‰§è¡Œæ—¶ç”±äºäº¤å‰æ‰§è¡Œè€Œå¯¼è‡´æ•°æ®çš„ä¸ä¸€è‡´ã€‚äº‹åŠ¡éš”ç¦»åˆ†ä¸ºä¸åŒçº§åˆ«ï¼ŒåŒ…æ‹¬è¯»æœªæäº¤ï¼ˆ"),v("code",[_._v("Read uncommitted")]),_._v("ï¼‰ã€è¯»æäº¤ï¼ˆ"),v("code",[_._v("read committed")]),_._v("ï¼‰ã€å¯é‡å¤è¯»ï¼ˆ"),v("code",[_._v("repeatable read")]),_._v("ï¼‰å’Œä¸²è¡ŒåŒ–ï¼ˆ"),v("code",[_._v("Serializable")]),_._v("ï¼‰ã€‚")]),_._v(" "),v("li",[v("strong",[_._v("æŒä¹…æ€§ï¼ˆDurabilityï¼‰:")]),_._v("  äº‹åŠ¡å¤„ç†ç»“æŸåï¼Œå¯¹æ•°æ®çš„ä¿®æ”¹å°±æ˜¯æ°¸ä¹…çš„ï¼Œå³ä¾¿ç³»ç»Ÿæ•…éšœä¹Ÿä¸ä¼šä¸¢å¤±ã€‚")])]),_._v(" "),v("p",[_._v("æ•°æ®åº“"),v("strong",[_._v("äº‹åŠ¡")]),_._v("æ˜¯ç”±æ•°æ®åº“ç³»ç»Ÿä¿è¯çš„ï¼Œæˆ‘ä»¬åªéœ€è¦æ ¹æ®ä¸šåŠ¡é€»è¾‘ä½¿ç”¨å®ƒå°±å¯ä»¥äº†ã€‚åœ¨"),v("code",[_._v("MySQL")]),_._v("ä¸­åªæœ‰ä½¿ç”¨äº†"),v("code",[_._v("Innodb")]),_._v("æ•°æ®åº“å¼•æ“çš„æ•°æ®åº“è¡¨æ‰æ”¯æŒäº‹åŠ¡ã€‚")]),_._v(" "),v("h2",{attrs:{id:"äº‹åŠ¡çš„å®ç°"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#äº‹åŠ¡çš„å®ç°"}},[_._v("#")]),_._v(" äº‹åŠ¡çš„å®ç°")]),_._v(" "),v("p",[_._v("äº‹åŠ¡éš”ç¦»æ€§æ˜¯"),v("strong",[_._v("é”")]),_._v("æ¥å®ç°çš„ï¼Œ "),v("code",[_._v("redo log")]),_._v("ï¼ˆé‡åšæ—¥å¿—ï¼‰ç”¨æ¥ä¿è¯äº‹åŠ¡çš„"),v("strong",[_._v("åŸå­æ€§å’ŒæŒä¹…æ€§")]),_._v("ï¼Œ"),v("code",[_._v("undo log")]),_._v("ç”¨æ¥ä¿è¯äº‹åŠ¡çš„"),v("strong",[_._v("ä¸€è‡´æ€§")]),_._v("ã€‚")]),_._v(" "),v("p",[_._v("æˆ–è®¸æœ‰äººè®¤ä¸º"),v("code",[_._v("redo")]),_._v("æ˜¯"),v("code",[_._v("undo")]),_._v("çš„é€†è¿‡ç¨‹ï¼Œå…¶å®ä¸å¯¹çš„ã€‚"),v("code",[_._v("redo")]),_._v("å’Œ"),v("code",[_._v("undo")]),_._v("çš„ä½œç”¨éƒ½å¯ä»¥çœ‹åšæ˜¯ä¸€ç§æ¢å¤æ“ä½œï¼Œ"),v("code",[_._v("redo")]),_._v("æ¢å¤æäº¤äº‹åŠ¡ä¿®æ”¹çš„é¡µï¼Œè€Œ"),v("code",[_._v("undo")]),_._v("å›æ»šè¡Œè®°å½•ã€‚å› æ­¤ä¸¤è€…è®°å½•çš„å†…å®¹ä¸åŒï¼Œ"),v("code",[_._v("redo")]),_._v("é€šå¸¸æ˜¯ç‰©ç†æ—¥å¿—ï¼Œè®°å½•çš„æ˜¯é¡µçš„ç‰©ç†ä¿®æ”¹æ“ä½œï¼Œ"),v("code",[_._v("undo")]),_._v("æ˜¯é€»è¾‘æ—¥å¿—ï¼Œæ ¹æ®æ¯è¡Œè®°å½•è¿›è¡Œè®°å½•ã€‚")]),_._v(" "),v("h3",{attrs:{id:"redo-log"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#redo-log"}},[_._v("#")]),_._v(" Redo Log")]),_._v(" "),v("p",[v("a",{attrs:{href:"https://dev.mysql.com/doc/refman/5.7/en/innodb-redo-log.html",target:"_blank",rel:"noopener noreferrer"}},[_._v("å®˜æ–¹æ–‡æ¡£"),v("OutboundLink")],1)]),_._v(" "),v("h4",{attrs:{id:"_1-åŸºæœ¬æ¦‚å¿µ"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#_1-åŸºæœ¬æ¦‚å¿µ"}},[_._v("#")]),_._v(" 1. åŸºæœ¬æ¦‚å¿µ")]),_._v(" "),v("p",[v("code",[_._v("redo log")]),_._v("åŒ…æ‹¬ä¸¤éƒ¨åˆ†ï¼šä¸€æ˜¯å†…å­˜ä¸­çš„æ—¥å¿—ç¼“å†²("),v("code",[_._v("redo log buffer")]),_._v(")ï¼Œå…¶æ˜“å¤±æ€§çš„ï¼›äºŒæ˜¯ç£ç›˜ä¸Šçš„é‡åšæ—¥å¿—æ–‡ä»¶("),v("code",[_._v("redo log file")]),_._v(")ï¼Œå…¶æ˜¯æŒä¹…çš„ã€‚")]),_._v(" "),v("p",[v("code",[_._v("InnoDB")]),_._v("æ˜¯äº‹åŠ¡çš„å­˜å‚¨å¼•æ“ï¼Œåœ¨æ¦‚å¿µä¸Šï¼Œå…¶é€šè¿‡"),v("strong",[_._v("Force Log at Commit")]),_._v("æœºåˆ¶å®ç°äº‹åŠ¡çš„æŒä¹…æ€§ï¼Œå³åœ¨äº‹åŠ¡æäº¤ï¼ˆCOMMITï¼‰æ—¶ï¼Œå¿…é¡»å…ˆå°†è¯¥äº‹åŠ¡çš„æ‰€æœ‰äº‹åŠ¡æ—¥å¿—å†™å…¥åˆ°ç£ç›˜ä¸Šçš„"),v("code",[_._v("redo log file")]),_._v("å’Œ"),v("code",[_._v("undo log file")]),_._v("ä¸­è¿›è¡ŒæŒä¹…åŒ–ï¼Œå¾…äº‹åŠ¡çš„"),v("code",[_._v("COMMIT")]),_._v("æ“ä½œå®Œæˆæ‰ç®—å®Œæˆã€‚")]),_._v(" "),v("p",[_._v("ä¸ºäº†ç¡®ä¿æ¯æ¬¡æ—¥å¿—éƒ½èƒ½å†™å…¥åˆ°äº‹åŠ¡æ—¥å¿—æ–‡ä»¶ä¸­ï¼Œåœ¨æ¯æ¬¡å°†æ—¥å¿—ç¼“å†²("),v("code",[_._v("redo log buffer")]),_._v(")å†™å…¥é‡åšæ—¥å¿—æ–‡ä»¶("),v("code",[_._v("redo log file")]),_._v(")ä¹‹åï¼Œ"),v("code",[_._v("InnoDB")]),_._v("å­˜å‚¨å¼•æ“éƒ½éœ€è¦è°ƒç”¨ä¸€æ¬¡"),v("code",[_._v("fsync")]),_._v("æ“ä½œ(å³fsync()ç³»ç»Ÿè°ƒç”¨)ã€‚\nä¹‹æ‰€ä»¥è¦ç»è¿‡ä¸€å±‚"),v("code",[_._v("os buffer")]),_._v("ï¼Œæ˜¯å› ä¸º"),v("code",[_._v("open")]),_._v("æ—¥å¿—æ–‡ä»¶çš„æ—¶å€™ï¼Œ"),v("code",[_._v("open")]),_._v("æ²¡æœ‰ä½¿ç”¨"),v("strong",[_._v("O_DIRECT")]),_._v("æ ‡å¿—ä½ï¼Œè¯¥æ ‡å¿—ä½æ„å‘³ç€ç»•è¿‡æ“ä½œç³»ç»Ÿå±‚çš„"),v("code",[_._v("os buffer")]),_._v("ï¼Œ"),v("code",[_._v("IO")]),_._v("ç›´å†™åˆ°åº•å±‚å­˜å‚¨è®¾å¤‡ã€‚\nä¸ä½¿ç”¨è¯¥æ ‡å¿—ä½æ„å‘³ç€å°†æ—¥å¿—è¿›è¡Œç¼“å†²ï¼Œç¼“å†²åˆ°äº†ä¸€å®šå®¹é‡æˆ–è€…æ˜¾å¼è°ƒç”¨"),v("code",[_._v("fsync()")]),_._v("æ‰ä¼šå°†ç¼“å†²ä¸­çš„æ—¥å¿—åˆ·åˆ°å­˜å‚¨è®¾å¤‡ã€‚å¦‚æœä½¿ç”¨è¯¥æ ‡å¿—ä½ï¼Œåˆ™æ„å‘³ç€æ¯æ¬¡éƒ½è¦å‘èµ·ç³»ç»Ÿè°ƒç”¨ã€‚")]),_._v(" "),v("p",[v("img",{attrs:{src:"/img/mysql/fsync.png",alt:"fsync"}})]),_._v(" "),v("p",[v("code",[_._v("InnoDB")]),_._v("å­˜å‚¨å¼•æ“å…è®¸ç”¨æˆ·æ‰‹å·¥è®¾ç½®éæŒä¹…æ€§çš„æƒ…å†µå‘ç”Ÿï¼Œä»¥æ­¤æé«˜æ•°æ®åº“çš„æ€§èƒ½ã€‚æ—¢å½“äº‹åŠ¡æäº¤æ—¶ï¼Œæ—¥å¿—ä¸å†™å…¥äº‹åŠ¡æ—¥å¿—æ–‡ä»¶ï¼Œè€Œæ˜¯ç­‰å¾…ä¸€ä¸ªæ—¶é—´å‘¨æœŸåå†æ‰§è¡Œ"),v("code",[_._v("fsync")]),_._v("æ“ä½œã€‚\nç”±äºå¹¶éå¼ºåˆ¶åœ¨äº‹åŠ¡æäº¤æ—¶è¿›è¡Œä¸€æ¬¡"),v("code",[_._v("fsync")]),_._v("æ“ä½œï¼Œæ˜¾ç„¶è¿™å¯ä»¥æ˜¾è‘—æé«˜æ•°æ®åº“çš„æ€§èƒ½ï¼Œä½†å½“æ•°æ®åº“å‘ç”Ÿå®•æœºæ—¶ï¼Œç”±äºéƒ¨åˆ†æ—¥å¿—æœªåˆ·æ–°åˆ°ç£ç›˜ï¼Œå› æ­¤ä¼šä¸¢å¤±æœ€åä¸€æ®µæ—¶é—´çš„äº‹åŠ¡ã€‚")]),_._v(" "),v("p",[_._v("å‚æ•°"),v("code",[_._v("innodb_flush_log_at_trx_commit")]),_._v("ç”¨æ¥æ§åˆ¶é‡åšæ—¥å¿—åˆ·æ–°åˆ°ç£ç›˜çš„ç­–ç•¥ï¼Œè¯¥å‚æ•°çš„é»˜è®¤å€¼ä¸º"),v("strong",[_._v("1")]),_._v("ã€‚å¯ä»¥é€šè¿‡å‘½ä»¤æŸ¥çœ‹æ­¤å‚æ•°çš„è®¾ç½®ï¼š")]),_._v(" "),v("div",{staticClass:"language-sql line-numbers-mode"},[v("pre",{pre:!0,attrs:{class:"language-sql"}},[v("code",[v("span",{pre:!0,attrs:{class:"token keyword"}},[_._v("select")]),_._v(" @"),v("span",{pre:!0,attrs:{class:"token variable"}},[_._v("@innodb_flush_log_at_trx_commit")]),v("span",{pre:!0,attrs:{class:"token punctuation"}},[_._v(";")]),_._v("\n")])]),_._v(" "),v("div",{staticClass:"line-numbers-wrapper"},[v("span",{staticClass:"line-number"},[_._v("1")]),v("br")])]),v("p",[_._v("å…¶ä¸­å‚æ•°å€¼å«ä¹‰å¦‚ä¸‹ï¼š")]),_._v(" "),v("ul",[v("li",[_._v("1  è¡¨ç¤ºäº‹åŠ¡æäº¤æ—¶å¿…é¡»è°ƒç”¨ä¸€æ¬¡"),v("code",[_._v("fsync")]),_._v("æ“ä½œï¼›")]),_._v(" "),v("li",[_._v("0  è¡¨ç¤ºäº‹åŠ¡æäº¤æ—¶ä¸è¿›è¡Œå†™å…¥"),v("code",[_._v("redo")]),_._v("æ—¥å¿—æ“ä½œï¼Œè¿™ä¸ªæ“ä½œä»…åœ¨ "),v("code",[_._v("master thread")]),_._v(" ä¸­å®Œæˆï¼Œè€Œåœ¨ "),v("code",[_._v("master thread")]),_._v(" ä¸­æ¯"),v("code",[_._v("1ç§’")]),_._v("ä¼šè¿›è¡Œä¸€æ¬¡"),v("code",[_._v("redo")]),_._v("æ—¥å¿—æ–‡ä»¶çš„"),v("code",[_._v("fsync")]),_._v("æ“ä½œï¼›")]),_._v(" "),v("li",[_._v("2  è¡¨ç¤ºäº‹åŠ¡æäº¤æ—¶æŠŠ"),v("code",[_._v("redo")]),_._v("æ—¥å¿—å†™å…¥ç£ç›˜æ–‡ä»¶å¯¹åº”çš„æ–‡ä»¶ç³»ç»Ÿçš„ç¼“å­˜ä¸­ï¼Œä¸è¿›è¡Œ"),v("code",[_._v("fsync")]),_._v("æ“ä½œï¼›\n"),v("img",{attrs:{src:"/img/mysql/innodb_flush_log_at_trx_commit.png",alt:"innodb_flush_log_at_trx_commit"}})])]),_._v(" "),v("h4",{attrs:{id:"_2-æ—¥å¿—å—-log-block"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#_2-æ—¥å¿—å—-log-block"}},[_._v("#")]),_._v(" 2. æ—¥å¿—å—(log block)")]),_._v(" "),v("p",[v("code",[_._v("InnoDB")]),_._v("å­˜å‚¨å¼•æ“ä¸­ï¼Œ"),v("code",[_._v("redo log")]),_._v("ä»¥å—ä¸ºå•ä½è¿›è¡Œå­˜å‚¨çš„ï¼Œæ¯ä¸ªå—å 512å­—èŠ‚ï¼Œè¿™ç§°ä¸º"),v("code",[_._v("redo log block")]),_._v("ã€‚")]),_._v(" "),v("h4",{attrs:{id:"_3-log-group-å’Œ-redo-log-file"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#_3-log-group-å’Œ-redo-log-file"}},[_._v("#")]),_._v(" 3. log group å’Œ redo log file")]),_._v(" "),v("p",[v("code",[_._v("log group")]),_._v(" æ˜¯é€»è¾‘ä¸Šçš„æ¦‚å¿µï¼Œå¹¶æ²¡æœ‰ä¸€ä¸ªå®é™…å­˜å‚¨çš„ç‰©ç†æ–‡ä»¶æ¥è¡¨ç¤º"),v("code",[_._v("log group")]),_._v("ä¿¡æ¯ã€‚"),v("code",[_._v("log group")]),_._v("è¡¨ç¤ºçš„æ˜¯"),v("code",[_._v("redo log group")]),_._v("ï¼Œä¸€ä¸ªç»„å†…ç”±å¤šä¸ªå¤§å°å®Œå…¨ç›¸åŒçš„"),v("code",[_._v("redo log file")]),_._v("ç»„æˆã€‚")]),_._v(" "),v("h4",{attrs:{id:"_4-redo-log-æ ¼å¼"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#_4-redo-log-æ ¼å¼"}},[_._v("#")]),_._v(" 4. redo log æ ¼å¼")]),_._v(" "),v("p",[_._v("ç”±äº"),v("code",[_._v("InnoDB")]),_._v("å­˜å‚¨å¼•æ“çš„å­˜å‚¨ç®¡ç†æ˜¯åŸºäºé¡µçš„ï¼Œæ•…å…¶"),v("code",[_._v("redo log")]),_._v("ä¹Ÿæ˜¯åŸºäºé¡µçš„ã€‚")]),_._v(" "),v("h4",{attrs:{id:"_5-lsn"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#_5-lsn"}},[_._v("#")]),_._v(" 5. LSN")]),_._v(" "),v("p",[v("strong",[_._v("LSN")]),_._v("ç§°ä¸ºæ—¥å¿—åºåˆ—å·(Log Sequence Number)ã€‚åœ¨"),v("code",[_._v("InnoDB")]),_._v("å­˜å‚¨å¼•æ“ä¸­ï¼Œ"),v("strong",[_._v("LSN")]),_._v("å ç”¨8ä¸ªå­—èŠ‚ï¼Œå¹¶ä¸”å•è°ƒé€’å¢ã€‚"),v("strong",[_._v("LSN")]),_._v("è¡¨ç¤ºçš„å«ä¹‰æœ‰ï¼š")]),_._v(" "),v("ul",[v("li",[_._v("é‡åšæ—¥å¿—å†™å…¥çš„æ€»é‡ï¼Œé€šè¿‡LSNå¼€å§‹å·ç å’Œç»“æŸå·ç å¯ä»¥è®¡ç®—å‡ºå†™å…¥çš„æ—¥å¿—é‡")]),_._v(" "),v("li",[_._v("checkpointï¼ˆæ£€æŸ¥ç‚¹ï¼‰ çš„ä½ç½®")]),_._v(" "),v("li",[_._v("é¡µçš„ç‰ˆæœ¬")])]),_._v(" "),v("h4",{attrs:{id:"_6-redo-log-æ€»ç»“"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#_6-redo-log-æ€»ç»“"}},[_._v("#")]),_._v(" 6. Redo Log æ€»ç»“ ğŸ‰")]),_._v(" "),v("ol",[v("li",[_._v("æ˜¯ Innodb å­˜å‚¨å¼•æ“å±‚ç”Ÿæˆçš„æ—¥å¿—ï¼Œå®ç°äº†äº‹åŠ¡çš„"),v("strong",[_._v("æŒä¹…æ€§")])]),_._v(" "),v("li",[_._v("å°†å†™æ“ä½œä»ç£ç›˜çš„ã€Œéšæœºå†™ã€å˜æˆäº†ã€Œé¡ºåºå†™ã€ï¼Œæå‡"),v("code",[_._v("MySQL")]),_._v("å†™å…¥ç£ç›˜çš„æ€§èƒ½ã€‚")]),_._v(" "),v("li",[v("strong",[_._v("WAL")]),_._v(" ï¼ˆWrite-Ahead Loggingï¼‰æŠ€æœ¯ï¼ŒæŒ‡çš„æ˜¯ MySQL çš„å†™æ“ä½œå¹¶ä¸æ˜¯ç«‹åˆ»æ›´æ–°åˆ°ç£ç›˜ä¸Šï¼Œè€Œæ˜¯å…ˆè®°å½•åœ¨æ—¥å¿—ï¼ˆRedo Logï¼‰ä¸Šï¼Œç„¶ååœ¨åˆé€‚çš„æ—¶é—´å†æ›´æ–°åˆ°ç£ç›˜ä¸Šã€‚")])]),_._v(" "),v("h3",{attrs:{id:"undo-log"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#undo-log"}},[_._v("#")]),_._v(" Undo Log")]),_._v(" "),v("p",[v("a",{attrs:{href:"https://dev.mysql.com/doc/refman/5.7/en/innodb-undo-logs.html",target:"_blank",rel:"noopener noreferrer"}},[_._v("å®˜æ–¹æ–‡æ¡£"),v("OutboundLink")],1)]),_._v(" "),v("h4",{attrs:{id:"_1-åŸºæœ¬æ¦‚å¿µ-2"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#_1-åŸºæœ¬æ¦‚å¿µ-2"}},[_._v("#")]),_._v(" 1. åŸºæœ¬æ¦‚å¿µ")]),_._v(" "),v("p",[v("strong",[v("code",[_._v("undo log")]),_._v("æœ‰ä¸¤ä¸ªä½œç”¨ï¼šæä¾›"),v("code",[_._v("å›æ»š")]),_._v("å’Œ"),v("code",[_._v("MVCC")]),_._v("(å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶)")]),_._v("ã€‚")]),_._v(" "),v("p",[_._v("å¯¹æ•°æ®åº“è¿›è¡Œä¿®æ”¹æ—¶ï¼Œ"),v("code",[_._v("InnoDB")]),_._v("å­˜å‚¨å¼•æ“ä¸ä½†ä¼šäº§ç”Ÿ"),v("code",[_._v("redo")]),_._v("ï¼Œè¿˜ä¼šäº§ç”Ÿç›¸å¯¹åº”çš„"),v("code",[_._v("undo")]),_._v("ï¼Œå¦‚æœç”¨æˆ·æ‰§è¡Œçš„äº‹åŠ¡æˆ–è¯­å¥ç”±äºæŸç§åŸå› å¤±è´¥äº†ï¼Œåˆæˆ–è€…ç”¨æˆ·ç”¨ä¸€æ¡"),v("strong",[_._v("ROLLBACK")]),_._v("è¯­å¥è¯·æ±‚å›æ»šï¼Œå°±å¯ä»¥å€ŸåŠ©è¯¥"),v("code",[_._v("undo")]),_._v("è¿›è¡Œ"),v("strong",[_._v("å›æ»š")]),_._v("ã€‚")]),_._v(" "),v("p",[v("code",[_._v("undo log")]),_._v(" å­˜æ”¾åœ¨æ•°æ®åº“å†…éƒ¨çš„ä¸€ä¸ªç‰¹æ®Šæ®µ("),v("code",[_._v("segment")]),_._v(")ä¸­ï¼Œè¿™ä¸ªæ®µç§°ä¸º"),v("code",[_._v("undo log segment")]),_._v("ã€‚")]),_._v(" "),v("p",[v("code",[_._v("undo log")]),_._v("å’Œ"),v("code",[_._v("redo log")]),_._v("è®°å½•ç‰©ç†æ—¥å¿—ä¸ä¸€æ ·ï¼Œå®ƒæ˜¯"),v("strong",[_._v("é€»è¾‘æ—¥å¿—")]),_._v("ã€‚"),v("code",[_._v("InnoDB")]),_._v("å­˜å‚¨å¼•æ“å›æ»šæ—¶ï¼Œå®ƒå®é™…ä¸Šåšçš„æ˜¯ä¸å…ˆå‰ç›¸åçš„å·¥ä½œã€‚å¯¹äºæ¯ä¸ª"),v("code",[_._v("INSERT")]),_._v("ï¼Œ"),v("code",[_._v("InnoDB")]),_._v("å­˜å‚¨å¼•æ“ä¼šå®Œæˆä¸€ä¸ª"),v("code",[_._v("DELETE")]),_._v("ï¼›\nå¯¹äºæ¯ä¸ª"),v("code",[_._v("DELETE")]),_._v("ï¼Œ"),v("code",[_._v("InnoDB")]),_._v("å­˜å‚¨å¼•æ“ä¼šæ‰§è¡Œä¸€ä¸ª"),v("code",[_._v("INSERT")]),_._v("ï¼›å¯¹äºæ¯ä¸ª"),v("code",[_._v("UPDATE")]),_._v("ï¼Œ"),v("code",[_._v("InnoDB")]),_._v("å­˜å‚¨å¼•æ“ä¼šæ‰§è¡Œä¸€ä¸ªç›¸åçš„"),v("code",[_._v("UPDATE")]),_._v("ã€‚")]),_._v(" "),v("p",[_._v("é™¤äº†"),v("code",[_._v("å›æ»š")]),_._v("æ“ä½œï¼Œ"),v("code",[_._v("undo")]),_._v("çš„ä¸¤ä¸€ä¸ªä½œç”¨æ˜¯"),v("code",[_._v("MVCC")]),_._v("ï¼Œå³åœ¨"),v("code",[_._v("InnoDB")]),_._v("å­˜å‚¨å¼•æ“ä¸­"),v("code",[_._v("MVCC")]),_._v("çš„å®ç°æ˜¯é€šè¿‡"),v("code",[_._v("undo")]),_._v("æ¥å®Œæˆçš„ã€‚å½“ç”¨æˆ·è¯»å–ä¸€è¡Œè®°å½•æ—¶ï¼Œè‹¥è¯¥è®°å½•å·²ç»è¢«å…¶ä»–çš„äº‹åŠ¡å ç”¨ï¼Œå½“å‰äº‹åŠ¡å¯ä»¥é€šè¿‡"),v("code",[_._v("undo")]),_._v("è¯»å–ä¹‹å‰çš„è¡Œç‰ˆæœ¬ä¿¡æ¯ï¼Œä»¥æ­¤å®ç°"),v("strong",[_._v("éé”å®šè¯»å–")]),_._v("ã€‚")]),_._v(" "),v("p",[_._v("æœ€åä¹Ÿæ˜¯æœ€é‡è¦çš„ä¸€ç‚¹æ˜¯ï¼Œ"),v("strong",[v("code",[_._v("undo log")]),_._v("ä¹Ÿä¼šäº§ç”Ÿ"),v("code",[_._v("redo log")]),_._v("ï¼Œå› ä¸º"),v("code",[_._v("undo log")]),_._v("ä¹Ÿè¦å®ç°æŒä¹…æ€§ä¿æŠ¤")]),_._v("ã€‚")]),_._v(" "),v("h4",{attrs:{id:"_2-undo-log-çš„å­˜å‚¨æ–¹å¼"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#_2-undo-log-çš„å­˜å‚¨æ–¹å¼"}},[_._v("#")]),_._v(" 2. undo log çš„å­˜å‚¨æ–¹å¼")]),_._v(" "),v("p",[v("code",[_._v("InnoDB")]),_._v("å­˜å‚¨å¼•æ“å¯¹"),v("code",[_._v("undo")]),_._v("çš„ç®¡ç†é‡‡ç”¨æ®µçš„æ–¹å¼ã€‚"),v("code",[_._v("rollback segment")]),_._v("ç§°ä¸º"),v("strong",[_._v("å›æ»šæ®µ")]),_._v("ï¼Œæ¯ä¸ªå›æ»šæ®µä¸­æœ‰1024ä¸ª"),v("code",[_._v("undo log segment")]),_._v("ã€‚")]),_._v(" "),v("h4",{attrs:{id:"_3-undo-log-å›æ»šæ—¥å¿—-æ€»ç»“"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#_3-undo-log-å›æ»šæ—¥å¿—-æ€»ç»“"}},[_._v("#")]),_._v(" 3. undo logï¼ˆå›æ»šæ—¥å¿—ï¼‰æ€»ç»“ ğŸ‰")]),_._v(" "),v("ol",[v("li",[_._v("æ˜¯ Innodb å­˜å‚¨å¼•æ“å±‚ç”Ÿæˆçš„æ—¥å¿—ï¼Œå®ç°äº†äº‹åŠ¡ä¸­çš„"),v("strong",[_._v("åŸå­æ€§")]),_._v("ï¼Œä¸»è¦ç”¨äºäº‹åŠ¡å›æ»šå’Œ"),v("strong",[_._v("MVCC")]),_._v("ï¼›")]),_._v(" "),v("li",[_._v("ä¸€ä¸ªäº‹åŠ¡åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œåœ¨è¿˜æ²¡æœ‰æäº¤äº‹åŠ¡ä¹‹å‰ï¼Œå¦‚æœMySQL å‘ç”Ÿäº†å´©æºƒï¼Œå¯ä»¥é€šè¿‡è¿™ä¸ªæ—¥å¿—ï¼ˆ"),v("strong",[_._v("undo log")]),_._v("ï¼‰å›æ»šåˆ°äº‹åŠ¡ä¹‹å‰çš„æ•°æ®ï¼›")]),_._v(" "),v("li",[_._v("MVCC æ˜¯é€šè¿‡ "),v("strong",[_._v("ReadView")]),_._v(" + undo log å®ç°çš„ã€‚undo log ä¸ºæ¯æ¡è®°å½•ä¿å­˜å¤šä»½å†å²æ•°æ®ï¼ŒMySQL åœ¨æ‰§è¡Œå¿«ç…§è¯»ï¼ˆæ™®é€š select è¯­å¥ï¼‰çš„æ—¶å€™ï¼Œä¼šæ ¹æ®äº‹åŠ¡çš„ ReadView é‡Œçš„ä¿¡æ¯ï¼Œé¡ºç€ undo log çš„ç‰ˆæœ¬é“¾æ‰¾åˆ°æ»¡è¶³å…¶å¯è§æ€§çš„è®°å½•ã€‚")])]),_._v(" "),v("div",{staticClass:"custom-block tip"},[v("p",{staticClass:"custom-block-title"},[_._v("redo log å’Œ undo log åŒºåˆ«åœ¨å“ªï¼Ÿ")]),_._v(" "),v("ul",[v("li",[_._v("redo log è®°å½•äº†æ­¤æ¬¡äº‹åŠ¡**ã€Œ"),v("strong",[_._v("å®Œæˆå")]),_._v("ã€çš„æ•°æ®çŠ¶æ€ï¼Œè®°å½•çš„æ˜¯æ›´æ–°ä¹‹ã€Œ"),v("strong",[_._v("å")]),_._v("ã€**çš„å€¼ï¼›")]),_._v(" "),v("li",[_._v("undo log è®°å½•äº†æ­¤æ¬¡äº‹åŠ¡**ã€Œ"),v("strong",[_._v("å¼€å§‹å‰")]),_._v("ã€çš„æ•°æ®çŠ¶æ€ï¼Œè®°å½•çš„æ˜¯æ›´æ–°ä¹‹ã€Œ"),v("strong",[_._v("å‰")]),_._v("ã€**çš„å€¼ï¼›")])])]),_._v(" "),v("h3",{attrs:{id:"purge"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#purge"}},[_._v("#")]),_._v(" purge")]),_._v(" "),v("p",[v("code",[_._v("purge")]),_._v(" ç”¨äºæœ€ç»ˆå®Œæˆ"),v("code",[_._v("delete")]),_._v("å’Œ"),v("code",[_._v("update")]),_._v("æ“ä½œã€‚è¿™æ ·è®¾è®¡æ˜¯å› ä¸º"),v("code",[_._v("InnoDB")]),_._v("å­˜å‚¨å¼•æ“æ”¯æŒ"),v("strong",[_._v("MVCC")]),_._v("ï¼Œæ‰€ä»¥è®°å½•ä¸èƒ½å†äº‹åŠ¡æäº¤æ—¶ç«‹å³è¿›è¡Œå¤„ç†ã€‚è¿™æ—¶å…¶ä»–äº‹åŠ¡å¯èƒ½æ­£åœ¨å¼•ç”¨è¿™è¡Œï¼Œæ•…"),v("code",[_._v("InnoDB")]),_._v("å­˜å‚¨å¼•æ“éœ€è¦ä¿å­˜è®°å½•ä¹‹å‰çš„ç‰ˆæœ¬ã€‚\nè€Œæ˜¯å¦å¯ä»¥åˆ é™¤è¯¥æ¡è®°å½•é€šè¿‡"),v("code",[_._v("purge")]),_._v("æ¥è¿›è¡Œåˆ¤æ–­ã€‚è‹¥è¯¥è¡Œè®°å½•å·²ä¸è¢«ä»»ä½•äº‹åŠ¡å¼•ç”¨ï¼Œé‚£ä¹ˆå°±å¯ä»¥è¿›è¡ŒçœŸæ­£çš„"),v("code",[_._v("delete")]),_._v("æ“ä½œã€‚")]),_._v(" "),v("div",{staticClass:"custom-block tip"},[v("p",{staticClass:"custom-block-title"},[_._v("å®˜æ–¹è§£é‡Š")]),_._v(" "),v("p",[_._v("In the InnoDB multi-versioning scheme, a row is not physically removed from the database immediately when you delete it with an SQL statement. InnoDB only physically removes the corresponding row and its index records when it discards the update undo log record written for the deletion. This removal operation is called a purge, and it is quite fast, usually taking the same order of time as the SQL statement that did the deletion.")])]),_._v(" "),v("h3",{attrs:{id:"group-commit"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#group-commit"}},[_._v("#")]),_._v(" group commit")]),_._v(" "),v("p",[_._v("ç»„æäº¤(group commit)å³ä¸€æ¬¡"),v("code",[_._v("fsync")]),_._v("å¯ä»¥åˆ·æ–°ç¡®ä¿å¤šä¸ªäº‹åŠ¡æ—¥å¿—è¢«å†™å…¥æ–‡ä»¶ã€‚")]),_._v(" "),v("h2",{attrs:{id:"äº‹åŠ¡éš”ç¦»çº§åˆ«"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#äº‹åŠ¡éš”ç¦»çº§åˆ«"}},[_._v("#")]),_._v(" äº‹åŠ¡éš”ç¦»çº§åˆ«")]),_._v(" "),v("table",[v("thead",[v("tr",[v("th",[_._v("åºå·")]),_._v(" "),v("th",[_._v("è‹±æ–‡å")]),_._v(" "),v("th",[_._v("ä¸­æ–‡å")]),_._v(" "),v("th",[_._v("è„è¯»")]),_._v(" "),v("th",[_._v("ä¸å¯é‡å¤è¯»")]),_._v(" "),v("th",[_._v("å¹»è¯»")])])]),_._v(" "),v("tbody",[v("tr",[v("td",[_._v("1")]),_._v(" "),v("td",[_._v("read_uncommited")]),_._v(" "),v("td",[_._v("è¯»æœªæäº¤")]),_._v(" "),v("td",[_._v("âŒ")]),_._v(" "),v("td",[_._v("âŒ")]),_._v(" "),v("td",[_._v("âŒ")])]),_._v(" "),v("tr",[v("td",[_._v("2")]),_._v(" "),v("td",[_._v("read_commited")]),_._v(" "),v("td",[_._v("è¯»å·²æäº¤")]),_._v(" "),v("td",[_._v("âœ…")]),_._v(" "),v("td",[_._v("âŒ")]),_._v(" "),v("td",[_._v("âŒ")])]),_._v(" "),v("tr",[v("td",[_._v("3")]),_._v(" "),v("td",[_._v("repeatable_read")]),_._v(" "),v("td",[_._v("å¯é‡å¤è¯»")]),_._v(" "),v("td",[_._v("âœ…")]),_._v(" "),v("td",[_._v("âœ…")]),_._v(" "),v("td",[_._v("âŒ")])]),_._v(" "),v("tr",[v("td",[_._v("4")]),_._v(" "),v("td",[_._v("serilizable")]),_._v(" "),v("td",[_._v("åºåˆ—åŒ–è¯»")]),_._v(" "),v("td",[_._v("âœ…")]),_._v(" "),v("td",[_._v("âœ…")]),_._v(" "),v("td",[_._v("âœ…")])])])]),_._v(" "),v("ul",[v("li",[_._v("âŒ  è¡¨ç¤ºå½“å‰äº‹åŠ¡çº§åˆ«æœªè§£å†³äº†æ­¤é—®é¢˜")]),_._v(" "),v("li",[_._v("âœ… è¡¨ç¤ºå½“å‰äº‹åŠ¡çº§åˆ«å·²ç»è§£å†³äº†æ­¤é—®é¢˜")])]),_._v(" "),v("h3",{attrs:{id:"è„è¯»"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#è„è¯»"}},[_._v("#")]),_._v(" è„è¯»")]),_._v(" "),v("p",[v("strong",[_._v("è„è¯»")]),_._v("é‡ç‚¹åœ¨äº"),v("code",[_._v("äº‹åŠ¡A")]),_._v("è¯»å–"),v("code",[_._v("äº‹åŠ¡B")]),_._v("å°šæœªæäº¤çš„æ›´æ”¹æ•°æ®("),v("strong",[_._v("UPDATE")]),_._v(")å¹¶åœ¨è¿™ä¸ªæ•°æ®çš„åŸºç¡€ä¸Šè¿›è¡Œæ“ä½œï¼Œè¿™æ—¶å€™å¦‚æœ"),v("code",[_._v("äº‹åŠ¡B")]),_._v("å›æ»šï¼Œé‚£ä¹ˆ"),v("code",[_._v("äº‹åŠ¡A")]),_._v("è¯»åˆ°çš„æ•°æ®æ˜¯ä¸è¢«æ‰¿è®¤çš„ã€‚äº§ç”Ÿçš„æµç¨‹å¦‚ä¸‹ï¼š")]),_._v(" "),v("table",[v("thead",[v("tr",[v("th",[_._v("åºå·")]),_._v(" "),v("th",[_._v("äº‹åŠ¡A")]),_._v(" "),v("th",[_._v("äº‹åŠ¡B")])])]),_._v(" "),v("tbody",[v("tr",[v("td",[_._v("1")]),_._v(" "),v("td",[_._v("start transaction;")]),_._v(" "),v("td")]),_._v(" "),v("tr",[v("td",[_._v("2")]),_._v(" "),v("td"),_._v(" "),v("td",[_._v("start transaction;")])]),_._v(" "),v("tr",[v("td",[_._v("3")]),_._v(" "),v("td",[_._v("select balance from account where id=1;  (ç»“æœä¸º100)")]),_._v(" "),v("td")]),_._v(" "),v("tr",[v("td",[_._v("4")]),_._v(" "),v("td"),_._v(" "),v("td",[_._v("update account set balance = 200 where id=1;")])]),_._v(" "),v("tr",[v("td",[_._v("5")]),_._v(" "),v("td",[_._v("select balance from account where id=1;  (ç»“æœä¸º200)")]),_._v(" "),v("td")])])]),_._v(" "),v("h3",{attrs:{id:"ä¸å¯é‡å¤è¯»"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#ä¸å¯é‡å¤è¯»"}},[_._v("#")]),_._v(" ä¸å¯é‡å¤è¯»")]),_._v(" "),v("p",[v("strong",[_._v("ä¸å¯é‡å¤è¯»")]),_._v("æ˜¯æŒ‡åœ¨åŒä¸€ä¸ªäº‹åŠ¡å†…ï¼Œä¸¤æ¬¡ç›¸åŒçš„æŸ¥è¯¢è¿”å›äº†ä¸åŒçš„ç»“æœã€‚"),v("code",[_._v("äº‹åŠ¡A")]),_._v("ç¬¬ä¸€æ¬¡è¯»å–æŸä¸€æ¡æ•°æ®åï¼Œ"),v("code",[_._v("äº‹åŠ¡B")]),v("strong",[_._v("æ›´æ–°è¯¥æ•°æ®å¹¶æäº¤äº†äº‹åŠ¡")]),_._v("ï¼Œ"),v("code",[_._v("äº‹åŠ¡A")]),_._v("å†æ¬¡è¯»å–è¯¥æ•°æ®ï¼Œä¸¤æ¬¡è¯»å–ä¾¿å¾—åˆ°äº†ä¸åŒçš„ç»“æœã€‚")]),_._v(" "),v("p",[_._v("ä¸å¯é‡å¤è¯»å’Œè„è¯»çš„åŒºåˆ«æ˜¯ï¼š"),v("strong",[_._v("è„è¯»æ˜¯è¯»åˆ°æœªæäº¤çš„æ•°æ®ï¼Œè€Œä¸å¯é‡å¤è¯»è¯»åˆ°çš„å´æ˜¯å·²ç»æäº¤çš„æ•°æ®")]),_._v("ï¼Œä½†æ˜¯å…¶è¿åäº†æ•°æ®åº“ä¸€è‡´æ€§çš„è¦æ±‚ã€‚")]),_._v(" "),v("p",[_._v("äº§ç”Ÿçš„æµç¨‹å¦‚ä¸‹ï¼š")]),_._v(" "),v("table",[v("thead",[v("tr",[v("th",[_._v("åºå·")]),_._v(" "),v("th",[_._v("äº‹åŠ¡A")]),_._v(" "),v("th",[_._v("äº‹åŠ¡B")])])]),_._v(" "),v("tbody",[v("tr",[v("td",[_._v("1")]),_._v(" "),v("td",[_._v("start transaction;")]),_._v(" "),v("td")]),_._v(" "),v("tr",[v("td",[_._v("2")]),_._v(" "),v("td"),_._v(" "),v("td",[_._v("start transaction;")])]),_._v(" "),v("tr",[v("td",[_._v("3")]),_._v(" "),v("td",[_._v("select balance from account where id=1;  (ç»“æœä¸º100)")]),_._v(" "),v("td")]),_._v(" "),v("tr",[v("td",[_._v("4")]),_._v(" "),v("td"),_._v(" "),v("td",[_._v("update account set balance = 200 where id=1;")])]),_._v(" "),v("tr",[v("td",[_._v("5")]),_._v(" "),v("td"),_._v(" "),v("td",[_._v("commit;")])]),_._v(" "),v("tr",[v("td",[_._v("6")]),_._v(" "),v("td",[_._v("select balance from account where id=1;  (ç»“æœä¸º200)")]),_._v(" "),v("td")])])]),_._v(" "),v("p",[v("strong",[_._v("ä¸å¯é‡å¤è¯»æœ‰ä¸€ç§ç‰¹æ®Šæƒ…å†µï¼Œä¸¤ä¸ªäº‹åŠ¡æ›´æ–°åŒä¸€æ¡æ•°æ®èµ„æºï¼Œåå®Œæˆçš„äº‹åŠ¡ä¼šé€ æˆå…ˆå®Œæˆçš„äº‹åŠ¡æ›´æ–°ä¸¢å¤±ï¼Œè¿™ç§æƒ…å†µå°±æ˜¯ç¬¬äºŒç±»ä¸¢å¤±æ›´æ–°")]),_._v("ã€‚äº§ç”Ÿçš„æµç¨‹å¦‚ä¸‹ï¼š")]),_._v(" "),v("table",[v("thead",[v("tr",[v("th",[_._v("åºå·")]),_._v(" "),v("th",[_._v("äº‹åŠ¡A")]),_._v(" "),v("th",[_._v("äº‹åŠ¡B")])])]),_._v(" "),v("tbody",[v("tr",[v("td",[_._v("1")]),_._v(" "),v("td",[_._v("start transaction;")]),_._v(" "),v("td")]),_._v(" "),v("tr",[v("td",[_._v("2")]),_._v(" "),v("td"),_._v(" "),v("td",[_._v("start transaction;")])]),_._v(" "),v("tr",[v("td",[_._v("3")]),_._v(" "),v("td",[_._v("select balance from account where id=1;  (ç»“æœä¸º100)")]),_._v(" "),v("td")]),_._v(" "),v("tr",[v("td",[_._v("4")]),_._v(" "),v("td"),_._v(" "),v("td",[_._v("select balance from account where id=1;  (ç»“æœä¸º100)")])]),_._v(" "),v("tr",[v("td",[_._v("5")]),_._v(" "),v("td"),_._v(" "),v("td",[_._v("update account set balance = 0 where id=1; ï¼ˆå–å‡º100å…ƒï¼‰")])]),_._v(" "),v("tr",[v("td",[_._v("6")]),_._v(" "),v("td"),_._v(" "),v("td",[_._v("commit;")])]),_._v(" "),v("tr",[v("td",[_._v("5")]),_._v(" "),v("td",[_._v("update account set balance = 200 where id=1; ï¼ˆå­˜å…¥100å…ƒï¼‰")]),_._v(" "),v("td")]),_._v(" "),v("tr",[v("td",[_._v("6")]),_._v(" "),v("td",[_._v("commit;")]),_._v(" "),v("td")]),_._v(" "),v("tr",[v("td",[_._v("6")]),_._v(" "),v("td",[_._v("select balance from account where id=1;  (ç»“æœä¸º200ï¼Œä¸¢å¤±æ›´æ–°)")]),_._v(" "),v("td")])])]),_._v(" "),v("p",[_._v("æˆ‘ä»¬åœ¨å¹³æ—¶å†™ä»£ç çš„æ—¶å€™ï¼Œéœ€è¦ç‰¹åˆ«æ³¨æ„"),v("strong",[_._v("ç¬¬äºŒç±»ä¸¢å¤±æ›´æ–°")]),_._v("(è¦†ç›–ä¸¢å¤±/ä¸¤æ¬¡æ›´æ–°é—®é¢˜ï¼ŒSecond lost update) çš„é—®é¢˜ï¼Œå¯ä»¥ä½¿ç”¨ä¹è§‚é”çš„è§£å†³è¿™ä¸ªé—®é¢˜ã€‚")]),_._v(" "),v("div",{staticClass:"custom-block tip"},[v("p",{staticClass:"custom-block-title"},[_._v("ç¬¬ä¸€ç±»ä¸¢å¤±æ›´æ–°(å›æ»šä¸¢å¤±ï¼ŒLost update)")]),_._v(" "),v("p",[_._v("åœ¨"),v("code",[_._v("äº‹åŠ¡A")]),_._v("æœŸé—´ï¼Œ"),v("code",[_._v("äº‹åŠ¡B")]),_._v("å¯¹æ•°æ®è¿›è¡Œäº†æ›´æ–°å¹¶æäº¤ï¼›åœ¨"),v("code",[_._v("äº‹åŠ¡A")]),_._v("å›æ»šä¹‹åï¼Œè¦†ç›–äº†"),v("code",[_._v("äº‹åŠ¡B")]),_._v("å·²ç»æäº¤çš„æ•°æ®ã€‚"),v("strong",[_._v("SQL92æ²¡æœ‰å®šä¹‰è¿™ç§ç°è±¡ï¼Œæ ‡å‡†å®šä¹‰çš„æ‰€æœ‰éš”ç¦»çº§åˆ«éƒ½ä¸å…è®¸ç¬¬ä¸€ç±»ä¸¢å¤±æ›´æ–°å‘ç”Ÿã€‚")])])]),_._v(" "),v("h3",{attrs:{id:"å¹»è¯»"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#å¹»è¯»"}},[_._v("#")]),_._v(" å¹»è¯»")]),_._v(" "),v("p",[v("strong",[_._v("å¹»è¯»")]),_._v("é‡ç‚¹åœ¨äº"),v("code",[_._v("Aäº‹åŠ¡")]),_._v("è¯»å–"),v("code",[_._v("Bäº‹åŠ¡")]),_._v("æäº¤çš„"),v("strong",[_._v("æ–°å¢æ•°æ®(INSERT)")]),_._v(",ä¼šå¼•å‘å¹»è¯»é—®é¢˜ã€‚å¹»è¯»ä¸€èˆ¬å‘ç”Ÿåœ¨è®¡ç®—ç»Ÿè®¡æ•°æ®çš„äº‹åŠ¡ä¸­ã€‚äº§ç”Ÿçš„æµç¨‹å¦‚ä¸‹ï¼š")]),_._v(" "),v("table",[v("thead",[v("tr",[v("th",[_._v("åºå·")]),_._v(" "),v("th",[_._v("äº‹åŠ¡A")]),_._v(" "),v("th",[_._v("äº‹åŠ¡B")])])]),_._v(" "),v("tbody",[v("tr",[v("td",[_._v("1")]),_._v(" "),v("td",[_._v("start transaction;")]),_._v(" "),v("td")]),_._v(" "),v("tr",[v("td",[_._v("2")]),_._v(" "),v("td"),_._v(" "),v("td",[_._v("start transaction;")])]),_._v(" "),v("tr",[v("td",[_._v("3")]),_._v(" "),v("td",[_._v("select count(*) from account_transfer_record where account_id=1;  (ç»“æœä¸º0)")]),_._v(" "),v("td")]),_._v(" "),v("tr",[v("td",[_._v("4")]),_._v(" "),v("td"),_._v(" "),v("td",[_._v("insert into account_transfer_record(id,account_id,amount) values(1,1,100);")])]),_._v(" "),v("tr",[v("td",[_._v("5")]),_._v(" "),v("td"),_._v(" "),v("td",[_._v("commit;")])]),_._v(" "),v("tr",[v("td",[_._v("6")]),_._v(" "),v("td",[_._v("select count(*) from account_transfer_record where account_id=1;  (ç»“æœä¸º1)")]),_._v(" "),v("td")])])]),_._v(" "),v("p",[v("code",[_._v("MySQL Innodbå­˜å‚¨å¼•æ“")]),_._v("çš„é»˜è®¤æ”¯æŒçš„éš”ç¦»çº§åˆ«æ˜¯"),v("code",[_._v("REPEATABLE-READï¼ˆå¯é‡è¯»ï¼‰")]),_._v("ã€‚å¯ä»¥é€šè¿‡å‘½ä»¤æŸ¥çœ‹æ•°æ®åº“äº‹åŠ¡æ•°æ®åº“éš”ç¦»çº§åˆ«ï¼š")]),_._v(" "),v("div",{staticClass:"language-sql line-numbers-mode"},[v("pre",{pre:!0,attrs:{class:"language-sql"}},[v("code",[v("span",{pre:!0,attrs:{class:"token comment"}},[_._v("-- `MySQL 8.0` è¯¥å‘½ä»¤æ”¹ä¸º`SELECT @@transaction_isolation;`")]),_._v("\n\n"),v("span",{pre:!0,attrs:{class:"token keyword"}},[_._v("SELECT")]),_._v(" @"),v("span",{pre:!0,attrs:{class:"token variable"}},[_._v("@tx_isolation")]),v("span",{pre:!0,attrs:{class:"token punctuation"}},[_._v(";")]),_._v("\n")])]),_._v(" "),v("div",{staticClass:"line-numbers-wrapper"},[v("span",{staticClass:"line-number"},[_._v("1")]),v("br"),v("span",{staticClass:"line-number"},[_._v("2")]),v("br"),v("span",{staticClass:"line-number"},[_._v("3")]),v("br")])]),v("p",[_._v("å¾ˆå¤šå…¬å¸æŠŠ"),v("code",[_._v("MySQL Innodbå­˜å‚¨å¼•æ“")]),_._v("çš„éš”ç¦»çº§åˆ«è®¾ç½®æˆ"),v("code",[_._v("READ-COMMITTED")]),_._v("ï¼Œæ˜¯ä¸ºäº†é˜²æ­¢é¢‘ç¹çš„å‡ºç°æ­»é”ï¼Œæ‰€ä»¥æˆ‘ä»¬å¹³æ—¶åœ¨å†™ä»£ç çš„æ—¶å€™éœ€è¦æ³¨æ„ã€‚")]),_._v(" "),v("div",{staticClass:"custom-block tip"},[v("p",{staticClass:"custom-block-title"},[_._v("å»¶ä¼¸æ€è€ƒ")]),_._v(" "),v("p",[_._v("æˆ‘ä»¬çŸ¥é“ï¼Œ"),v("code",[_._v("MySQL Innodb")]),_._v("å­˜å‚¨å¼•æ“é»˜è®¤çš„äº‹åŠ¡éš”ç¦»çº§åˆ«æ˜¯"),v("code",[_._v("RR")]),_._v("ï¼Œæ˜¯ä¼šå‡ºç°å¹»è¯»çš„ï¼Œé‚£ä¹ˆå®ƒæ˜¯å¦‚ä½•é¿å…å¹»è¯»çš„å‘¢ï¼Ÿ")])]),_._v(" "),v("h2",{attrs:{id:"mysqlæ˜¯æ€ä¹ˆè§£å†³å¹»è¯»é—®é¢˜çš„"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#mysqlæ˜¯æ€ä¹ˆè§£å†³å¹»è¯»é—®é¢˜çš„"}},[_._v("#")]),_._v(" MySQLæ˜¯æ€ä¹ˆè§£å†³å¹»è¯»é—®é¢˜çš„ï¼Ÿ")]),_._v(" "),v("ul",[v("li",[v("strong",[_._v("å¿«ç…§è¯»")]),_._v(": é€šè¿‡"),v("code",[_._v("MVCC")]),_._v("ï¼ˆå¹¶å‘å¤šç‰ˆæœ¬æ§åˆ¶ï¼‰æ¥è§£å†³å¹»è¯»é—®é¢˜\n"),v("ul",[v("li",[_._v("MVCC çš„å®ç°ä¾èµ–äºï¼š"),v("code",[_._v("éšè—å­—æ®µ")]),_._v("ã€"),v("code",[_._v("Read View")]),_._v("ã€"),v("code",[_._v("undo log")])]),_._v(" "),v("li",[_._v("éšè—å­—æ®µï¼šäº‹åŠ¡IDã€å›æ»šæŒ‡é’ˆã€DB_ROW_IDï¼ˆå¦‚æœæ²¡æœ‰è®¾ç½®ä¸»é”®ä¸”è¯¥è¡¨æ²¡æœ‰å”¯ä¸€éç©ºç´¢å¼•æ—¶ï¼ŒInnoDB ä¼šä½¿ç”¨è¯¥ id æ¥ç”Ÿæˆèšç°‡ç´¢å¼•ï¼‰")])])]),_._v(" "),v("li",[v("strong",[_._v("å®æ—¶è¯»")]),_._v("ï¼ˆæ‰§è¡Œ "),v("code",[_._v("select...for update/lock in share mode")]),_._v("ã€"),v("code",[_._v("insert")]),_._v("ã€"),v("code",[_._v("update")]),_._v("ã€"),v("code",[_._v("delete")]),_._v("ï¼‰: é€šè¿‡"),v("strong",[_._v("é‡‡ç”¨"),v("code",[_._v("Next-Key Locking")]),_._v("æœºåˆ¶")]),_._v("æ¥è§£å†³å¹»è¯»é—®é¢˜")])]),_._v(" "),v("h3",{attrs:{id:"å¿«ç…§è¯»"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#å¿«ç…§è¯»"}},[_._v("#")]),_._v(" å¿«ç…§è¯»")]),_._v(" "),v("p",[v("code",[_._v("MySQL")]),_._v("é»˜è®¤çš„éš”ç¦»çº§åˆ«æ˜¯"),v("strong",[_._v("å¯é‡å¤è¯»(RR)")]),_._v("ï¼Œè¿™ç§éš”ç¦»çº§åˆ«ä¸‹ï¼Œæ™®é€šçš„"),v("code",[_._v("SELECT")]),_._v("è¯­å¥éƒ½æ˜¯"),v("strong",[_._v("å¿«ç…§è¯»")]),_._v("ï¼Œä¹Ÿå°±æ˜¯åœ¨ä¸€ä¸ªäº‹åŠ¡å†…ï¼Œå¤šæ¬¡æ‰§è¡Œ"),v("code",[_._v("SELECT")]),_._v("è¯­å¥ï¼ŒæŸ¥è¯¢åˆ°çš„æ•°æ®éƒ½æ˜¯äº‹åŠ¡å¼€å§‹æ—¶é‚£ä¸ªçŠ¶æ€çš„æ•°æ®ã€‚")]),_._v(" "),v("p",[v("strong",[_._v("å¿«ç…§è¯»")]),_._v("å°±æ˜¯åœ¨æ¯ä¸€è¡Œæ•°æ®ä¸­é¢å¤–ä¿å­˜"),v("strong",[_._v("ä¸¤ä¸ªéšè—çš„åˆ—")]),_._v("ï¼Œåˆ†åˆ«æ˜¯ï¼šæ’å…¥è¿™ä¸ªæ•°æ®è¡Œæ—¶çš„ç‰ˆæœ¬å·/åˆ é™¤è¿™ä¸ªæ•°æ®è¡Œæ—¶çš„ç‰ˆæœ¬å·ï¼ˆ"),v("strong",[_._v("äº‹åŠ¡çš„ID")]),_._v(" | å¯èƒ½ä¸ºç©ºï¼‰ï¼Œæ»šåŠ¨æŒ‡é’ˆ(æŒ‡å‘"),v("code",[_._v("undo log")]),_._v("ä¸­ç”¨äºäº‹åŠ¡å›æ»šçš„æ—¥å¿—è®°å½•)ã€‚")]),_._v(" "),v("p",[_._v("äº‹åŠ¡åœ¨å¯¹æ•°æ®ä¿®æ”¹åï¼Œè¿›è¡Œä¿å­˜æ—¶ï¼Œå¦‚æœæ•°æ®è¡Œçš„å½“å‰ç‰ˆæœ¬å·ä¸äº‹åŠ¡å¼€å§‹å–å¾—æ•°æ®çš„ç‰ˆæœ¬å·ä¸€è‡´å°±ä¿å­˜æˆåŠŸï¼Œå¦åˆ™ä¿å­˜å¤±è´¥ã€‚")]),_._v(" "),v("ul",[v("li",[v("strong",[_._v("insert")])])]),_._v(" "),v("p",[_._v("æ’å…¥ä¸€è¡Œæ•°æ®æ—¶ï¼Œå°†"),v("strong",[_._v("äº‹åŠ¡çš„ID")]),_._v("ä½œä¸ºæ•°æ®è¡Œçš„åˆ›å»ºç‰ˆæœ¬å·ã€‚")]),_._v(" "),v("ul",[v("li",[v("strong",[_._v("delete")])])]),_._v(" "),v("p",[_._v("æ‰§è¡Œåˆ é™¤æ“ä½œæ—¶ï¼Œä¼šå°†åŸæ•°æ®è¡Œçš„åˆ é™¤ç‰ˆæœ¬å·è®¾ç½®ä¸ºå½“å‰"),v("strong",[_._v("äº‹åŠ¡çš„ID")]),_._v("ï¼Œç„¶åæ ¹æ®åŸæ•°æ®è¡Œç”Ÿæˆä¸€æ¡"),v("code",[_._v("INSERT")]),_._v("è¯­å¥ï¼Œå†™å…¥"),v("code",[_._v("undo log")]),_._v("ï¼Œç”¨äºäº‹åŠ¡æ‰§è¡Œå¤±è´¥æ—¶å›æ»šã€‚\n"),v("code",[_._v("delete")]),_._v("æ“ä½œå®é™…ä¸Š"),v("strong",[_._v("ä¸ä¼šç›´æ¥åˆ é™¤")]),_._v("ï¼Œè€Œæ˜¯å°†"),v("code",[_._v("delete")]),_._v("å¯¹è±¡æ‰“ä¸Š"),v("code",[_._v("delete flag")]),_._v("ï¼Œæ ‡è®°ä¸ºåˆ é™¤ï¼Œæœ€ç»ˆçš„åˆ é™¤æ“ä½œæ˜¯"),v("code",[_._v("purge")]),_._v("çº¿ç¨‹å®Œæˆçš„ã€‚\nä½†æ˜¯ä¼šå°†æ•°æ®è¡Œçš„åˆ é™¤ç‰ˆæœ¬å·è®¾ç½®ä¸ºå½“å‰çš„"),v("strong",[_._v("äº‹åŠ¡çš„ID")]),_._v("ï¼Œè¿™æ ·åé¢çš„"),v("strong",[_._v("äº‹åŠ¡B")]),_._v("å³ä¾¿æŸ¥åˆ°è¿™è¡Œæ•°æ®ç”±äº"),v("strong",[_._v("äº‹åŠ¡B")]),_._v("çš„ID > åˆ é™¤ç‰ˆæœ¬å·ï¼Œä¹Ÿä¼šå¿½ç•¥è¿™æ¡æ•°æ®ã€‚")]),_._v(" "),v("ul",[v("li",[v("strong",[_._v("update")])])]),_._v(" "),v("p",[_._v("æ›´æ–°æ—¶å¯ä»¥ç®€å•çš„è®¤ä¸ºæ˜¯å…ˆå°†æ—§æ•°æ®åˆ é™¤ï¼Œç„¶åæ’å…¥ä¸€æ¡æ–°æ•°æ®ã€‚")]),_._v(" "),v("p",[_._v("æ‰€ä»¥æ‰§è¡Œæ›´æ–°æ“ä½œæ—¶ï¼Œå…¶å®æ˜¯ä¼šå°†åŸæ•°æ®è¡Œçš„åˆ é™¤ç‰ˆæœ¬å·è®¾ç½®ä¸ºå½“å‰"),v("strong",[_._v("äº‹åŠ¡çš„ID")]),_._v("ï¼Œç”Ÿæˆä¸€æ¡"),v("code",[_._v("INSERT")]),_._v("è¯­å¥ï¼Œå†™å…¥"),v("code",[_._v("undo log")]),_._v("ï¼Œç”¨äºäº‹åŠ¡æ‰§è¡Œå¤±è´¥æ—¶å›æ»šã€‚\næ’å…¥ä¸€æ¡æ–°çš„æ•°æ®ï¼Œå°†"),v("strong",[_._v("äº‹åŠ¡çš„ID")]),_._v("ä½œä¸ºæ•°æ®è¡Œçš„çš„åˆ›å»ºç‰ˆæœ¬å·ã€‚")]),_._v(" "),v("ul",[v("li",[v("strong",[_._v("select")])])]),_._v(" "),v("p",[_._v("é¦–å…ˆè¯»å–æ•°æ®çš„å‰ææ¡ä»¶æ˜¯ï¼šæ•°æ®è¡Œçš„åˆ›å»ºç‰ˆæœ¬å·"),v("code",[_._v("<=")]),_._v("å½“å‰äº‹åŠ¡ç‰ˆæœ¬å· ï¼ˆå¦åˆ™æ•°æ®æ˜¯åé¢çš„äº‹åŠ¡åˆ›å»ºå‡ºæ¥çš„ï¼‰ã€æ•°æ®è¡Œåˆ é™¤ç‰ˆæœ¬å·ä¸ºç©ºæˆ–è€…"),v("code",[_._v(">")]),_._v("å½“å‰äº‹åŠ¡ç‰ˆæœ¬å·çš„æ•°æ®ï¼ˆå¦åˆ™æ•°æ®å·²ç»è¢«æ ‡è®°åˆ é™¤äº†)")]),_._v(" "),v("p",[_._v("å¦‚æœè¯¥è¡Œæ•°æ®æ²¡æœ‰è¢«åŠ è¡Œé”ä¸­çš„"),v("code",[_._v("X")]),_._v("é”ï¼ˆä¹Ÿå°±æ˜¯æ²¡æœ‰å…¶ä»–äº‹åŠ¡å¯¹è¿™è¡Œæ•°æ®è¿›è¡Œä¿®æ”¹ï¼‰ï¼Œé‚£ä¹ˆç›´æ¥è¯»å–æ•°æ®ã€‚")]),_._v(" "),v("p",[_._v("å¦‚æœè¯¥è¡Œæ•°æ®è¢«åŠ äº†è¡Œé”"),v("code",[_._v("X")]),_._v("é”ï¼ˆä¹Ÿå°±æ˜¯ç°åœ¨æœ‰å…¶ä»–äº‹åŠ¡å¯¹è¿™è¡Œæ•°æ®è¿›è¡Œä¿®æ”¹ï¼‰ï¼Œé‚£ä¹ˆè¯»æ•°æ®çš„äº‹åŠ¡ä¸ä¼šè¿›è¡Œç­‰å¾…ï¼Œè€Œæ˜¯å›å»"),v("code",[_._v("undo log")]),_._v("ç«¯é‡Œé¢è¯»ä¹‹å‰ç‰ˆæœ¬çš„æ•°æ®ï¼ˆè¿™é‡Œå­˜å‚¨çš„æ•°æ®æœ¬èº«æ˜¯ç”¨äºå›æ»šçš„ï¼‰ï¼Œ\nåœ¨"),v("strong",[_._v("å¯é‡å¤è¯»")]),_._v("çš„éš”ç¦»çº§åˆ«ä¸‹ï¼Œä»"),v("code",[_._v("undo log")]),_._v("ä¸­è¯»å–çš„æ•°æ®æ€»æ˜¯äº‹åŠ¡å¼€å§‹æ—¶çš„å¿«ç…§æ•°æ®ï¼Œåœ¨"),v("strong",[_._v("æäº¤è¯»")]),_._v("çš„éš”ç¦»çº§åˆ«ä¸‹ï¼Œä»"),v("code",[_._v("undo log")]),_._v("ä¸­è¯»å–çš„æ€»æ˜¯æœ€æ–°çš„å¿«ç…§æ•°æ®ã€‚")]),_._v(" "),v("h3",{attrs:{id:"å®æ—¶è¯»"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#å®æ—¶è¯»"}},[_._v("#")]),_._v(" å®æ—¶è¯»")]),_._v(" "),v("p",[_._v("ä½¿ç”¨"),v("code",[_._v("ä¸€è‡´æ€§è¯»å®šé”")]),_._v("è¿›è¡ŒæŸ¥è¯¢æ—¶å°±æ˜¯"),v("strong",[_._v("å®æ—¶è¯»")]),_._v("ï¼Œè¯»(locking read)æ“ä½œï¼š")]),_._v(" "),v("div",{staticClass:"language-sql line-numbers-mode"},[v("pre",{pre:!0,attrs:{class:"language-sql"}},[v("code",[v("span",{pre:!0,attrs:{class:"token operator"}},[_._v("-")]),_._v(" "),v("span",{pre:!0,attrs:{class:"token keyword"}},[_._v("SELECT")]),v("span",{pre:!0,attrs:{class:"token punctuation"}},[_._v(".")]),v("span",{pre:!0,attrs:{class:"token punctuation"}},[_._v(".")]),v("span",{pre:!0,attrs:{class:"token punctuation"}},[_._v(".")]),v("span",{pre:!0,attrs:{class:"token keyword"}},[_._v("FOR")]),_._v(" "),v("span",{pre:!0,attrs:{class:"token keyword"}},[_._v("UPDATE")]),_._v(" "),v("span",{pre:!0,attrs:{class:"token punctuation"}},[_._v("(")]),_._v("Xé”"),v("span",{pre:!0,attrs:{class:"token punctuation"}},[_._v(")")]),_._v("\n"),v("span",{pre:!0,attrs:{class:"token operator"}},[_._v("-")]),_._v(" "),v("span",{pre:!0,attrs:{class:"token keyword"}},[_._v("SELECT")]),v("span",{pre:!0,attrs:{class:"token punctuation"}},[_._v(".")]),v("span",{pre:!0,attrs:{class:"token punctuation"}},[_._v(".")]),v("span",{pre:!0,attrs:{class:"token punctuation"}},[_._v(".")]),v("span",{pre:!0,attrs:{class:"token keyword"}},[_._v("LOCK")]),_._v(" "),v("span",{pre:!0,attrs:{class:"token operator"}},[_._v("IN")]),_._v(" "),v("span",{pre:!0,attrs:{class:"token keyword"}},[_._v("SHARE")]),_._v(" "),v("span",{pre:!0,attrs:{class:"token keyword"}},[_._v("MODE")]),_._v(" "),v("span",{pre:!0,attrs:{class:"token punctuation"}},[_._v("(")]),_._v("Sé”"),v("span",{pre:!0,attrs:{class:"token punctuation"}},[_._v(")")]),_._v("\n")])]),_._v(" "),v("div",{staticClass:"line-numbers-wrapper"},[v("span",{staticClass:"line-number"},[_._v("1")]),v("br"),v("span",{staticClass:"line-number"},[_._v("2")]),v("br")])]),v("p",[_._v("ä½¿ç”¨ "),v("strong",[_._v("Next-Key Lock")]),_._v("ï¼ˆ"),v("code",[_._v("Gap Lock")]),_._v("+"),v("code",[_._v("Record Lock")]),_._v(" ï¼Œé”å®šä¸€ä¸ªèŒƒå›´ï¼Œå¹¶ä¸”é”å®šè®°å½•æœ¬èº«ï¼‰"),v("strong",[_._v("åŠ é”")]),_._v("ï¼Œæ¥è§£å†³å¹»è¯»é—®é¢˜ã€‚")]),_._v(" "),v("hr"),_._v(" "),v("h2",{attrs:{id:"mvcc-å®ç°åŸç†"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#mvcc-å®ç°åŸç†"}},[_._v("#")]),_._v(" MVCC å®ç°åŸç† ğŸ‰")]),_._v(" "),v("p",[_._v("MVCC çš„å®ç°ä¾èµ–äºï¼šéšè—å­—æ®µã€Read Viewã€undo log")]),_._v(" "),v("ol",[v("li",[v("strong",[_._v("é€šè¿‡äº‹åŠ¡IDï¼ˆDB_TRX_IDï¼‰å’Œ ReadView æ¥åˆ¤æ–­æ•°æ®çš„å¯è§æ€§")]),_._v("ï¼›")]),_._v(" "),v("li",[_._v("å¦‚å¯è§ï¼Œåˆ™è¿”å› ReadView è§„åˆ™çš„ç‰ˆæœ¬æ•°æ®ï¼›")]),_._v(" "),v("li",[_._v("å¦‚ä¸å¯è§ï¼Œåˆ™é€šè¿‡"),v("strong",[_._v("å›æ»šæŒ‡é’ˆ")]),_._v("ï¼ˆDB_ROLL_PTRï¼‰æ‰¾åˆ° undo log ä¸­çš„å†å²ç‰ˆæœ¬æ•°æ®ï¼›")])]),_._v(" "),v("h3",{attrs:{id:"éšè—å­—æ®µ"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#éšè—å­—æ®µ"}},[_._v("#")]),_._v(" éšè—å­—æ®µ")]),_._v(" "),v("p",[_._v("InnoDB å­˜å‚¨å¼•æ“ä¸ºæ¯è¡Œæ•°æ®æ·»åŠ äº†ä¸‰ä¸ª éšè—å­—æ®µï¼š")]),_._v(" "),v("ol",[v("li",[_._v("DB_TRX_IDï¼ˆ6å­—èŠ‚ï¼‰ï¼šè¡¨ç¤ºæœ€åä¸€æ¬¡æ’å…¥æˆ–æ›´æ–°è¯¥è¡Œçš„äº‹åŠ¡IDã€‚æ­¤å¤–ï¼Œdelete æ“ä½œåœ¨å†…éƒ¨è¢«è§†ä¸ºæ›´æ–°ï¼Œåªä¸è¿‡ä¼šåœ¨è®°å½•å¤´ Record header ä¸­çš„ deleted_flag å­—æ®µå°†å…¶æ ‡è®°ä¸ºå·²åˆ é™¤")]),_._v(" "),v("li",[_._v("DB_ROLL_PTRï¼ˆ7å­—èŠ‚ï¼‰ "),v("strong",[_._v("å›æ»šæŒ‡é’ˆ")]),_._v("ï¼ŒæŒ‡å‘è¯¥è¡Œçš„ undo log ã€‚å¦‚æœè¯¥è¡Œæœªè¢«æ›´æ–°ï¼Œåˆ™ä¸ºç©º")]),_._v(" "),v("li",[_._v("DB_ROW_IDï¼ˆ6å­—èŠ‚ï¼‰ï¼šå¦‚æœæ²¡æœ‰è®¾ç½®ä¸»é”®ä¸”è¯¥è¡¨æ²¡æœ‰å”¯ä¸€éç©ºç´¢å¼•æ—¶ï¼ŒInnoDB ä¼šä½¿ç”¨è¯¥ id æ¥ç”Ÿæˆèšç°‡ç´¢å¼•")])]),_._v(" "),v("h3",{attrs:{id:"readview"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#readview"}},[_._v("#")]),_._v(" ReadView")]),_._v(" "),v("blockquote",[v("p",[_._v("Read view lists the trx ids of those transactions for which a consistent read should not see the modifications to the database.")])]),_._v(" "),v("p",[_._v("ReadViewæ˜¯äº‹åŠ¡å¼€å¯æ—¶ï¼Œ"),v("strong",[_._v("å½“å‰æ‰€æœ‰æ´»è·ƒäº‹åŠ¡ï¼ˆè¿˜æœªæäº¤çš„äº‹åŠ¡ï¼‰çš„ä¸€ä¸ªé›†åˆ")]),_._v("ï¼ŒReadViewæ•°æ®ç»“æ„å†³å®šäº†ä¸åŒäº‹åŠ¡éš”ç¦»çº§åˆ«ä¸‹ï¼Œæ•°æ®çš„å¯è§æ€§ã€‚")]),_._v(" "),v("ol",[v("li",[_._v("ReadViewçš„ç»„æˆ\n"),v("ul",[v("li",[_._v("m_idsï¼š"),v("strong",[_._v("å­˜äº†å½“å‰æ•°æ®åº“ç³»ç»Ÿä¸­æ­£å¤„äºæ´»è·ƒï¼ˆæ²¡æœ‰ commitï¼‰çš„äº‹åŠ¡çš„IDåˆ—è¡¨")])]),_._v(" "),v("li",[_._v("min_trx_idï¼šm_idsé‡Œæœ€å°çš„å€¼ï¼›")]),_._v(" "),v("li",[_._v("max_trx_idï¼šmysqlä¸‹ä¸€ä¸ªè¦ç”Ÿæˆçš„äº‹åŠ¡idï¼Œå°±æ˜¯æœ€å¤§äº‹åŠ¡idï¼›")]),_._v(" "),v("li",[_._v("creator_trx_idï¼šå½“å‰è¿™ä¸ªäº‹åŠ¡çš„idï¼›")])])]),_._v(" "),v("li",[_._v("æ•°æ®å¯è§æ€§ï¼šInnoDB ä¼šå°†è¯¥è®°å½•è¡Œçš„ DB_TRX_ID ä¸ Read View ä¸­çš„ä¸€äº›å˜é‡åŠå½“å‰äº‹åŠ¡ ID è¿›è¡Œæ¯”è¾ƒ\n"),v("ul",[v("li",[_._v("å½“ DB_TRX_ID < min_trx_id è¡¨ç¤ºæ­¤ç‰ˆæœ¬æ˜¯å·²ç»æäº¤çš„äº‹åŠ¡ç”Ÿæˆçš„ï¼Œæ•°æ®å¯è§")]),_._v(" "),v("li",[_._v("å½“ DB_TRX_ID > max_trx_id è¡¨ç¤ºæ­¤ç‰ˆæœ¬æ˜¯ç”±å°†æ¥å¯åŠ¨çš„äº‹åŠ¡ç”Ÿæˆçš„ï¼Œæ•°æ®ä¸å¯è§")]),_._v(" "),v("li",[_._v("å½“ DB_TRX_ID >= min_trx_id & DB_TRX_ID <= max_trx_id\n"),v("ul",[v("li",[_._v("å¦‚æœ DB_TRX_ID åœ¨ m_ids çš„æ•°ç»„ä¸­ï¼Œæ•°æ®ä¸å¯è§ï¼Œä½†å¯¹å½“å‰è‡ªå·±çš„äº‹åŠ¡æ˜¯å¯è§çš„")]),_._v(" "),v("li",[_._v("å¦‚æœ DB_TRX_ID ä¸åœ¨ m_ids çš„æ•°ç»„ä¸­ï¼Œæ•°æ®å¯è§")])])])])]),_._v(" "),v("li",[_._v("ç”Ÿæˆçš„æ—¶æœº\n"),v("ul",[v("li",[_._v("RCï¼šæ¯ä¸ªæŸ¥è¯¢éƒ½å•ç‹¬æ„å»ºReadView")]),_._v(" "),v("li",[_._v("RRï¼šäº‹åŠ¡å¼€å§‹åç¬¬ä¸€æ¡selectæ—¶ç”Ÿæˆä¸€ä¸ªReadViewï¼Œä¸€ç›´ç”¨åˆ°äº‹åŠ¡ç»“æŸ")])])])]),_._v(" "),v("h3",{attrs:{id:"undo-log-ç‰ˆæœ¬é“¾"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#undo-log-ç‰ˆæœ¬é“¾"}},[_._v("#")]),_._v(" undo log ç‰ˆæœ¬é“¾")]),_._v(" "),v("p",[v("img",{attrs:{src:"/img/mysql/undo-log-link.png",alt:"undo-log-link.png"}})]),_._v(" "),v("ol",[v("li",[_._v("å‡è®¾æœ‰ä¸€ä¸ªäº‹åŠ¡Aï¼ˆäº‹åŠ¡ID=50ï¼‰æ’å…¥ä¸€æ¡æ•°æ®ï¼Œé‚£ä¹ˆæ­¤æ—¶è¿™æ¡æ•°æ®çš„éšè—å­—æ®µï¼šäº‹åŠ¡ID=50ã€"),v("strong",[_._v("å›æ»šæŒ‡é’ˆ")]),_._v("ï¼ˆDB_ROLL_PTRï¼‰æŒ‡å‘çš„ç©ºçš„undo logï¼›")]),_._v(" "),v("li",[_._v("å½“æœ‰å¦ä¸€ä¸ªäº‹åŠ¡Bï¼ˆäº‹åŠ¡ID=51ï¼‰æ›´æ–°è¿™æ¡æ•°æ®ï¼Œé‚£ä¹ˆæ­¤æ—¶æ›´æ–°ä¹‹å‰ä¼šç”Ÿæˆä¸€ä¸ª undo log è®°å½•ï¼ˆäº‹åŠ¡Açš„å€¼ï¼‰ï¼Œè¿™æ¡æ•°æ®çš„éšè—å­—æ®µï¼šäº‹åŠ¡ID=51ã€"),v("strong",[_._v("å›æ»šæŒ‡é’ˆ")]),_._v("æŒ‡å‘åˆšç”Ÿæˆçš„undo logï¼›")]),_._v(" "),v("li",[_._v("å½“å†æœ‰ä¸€ä¸ªäº‹åŠ¡Cæ›´æ–°è¿™æ¡æ•°æ®ï¼ŒåŒæ­¥éª¤2ï¼Œè¿™æ ·å°±å½¢æˆäº† undo log ç‰ˆæœ¬é“¾ï¼›")])]),_._v(" "),v("p",[v("strong",[_._v("å‚è€ƒæ–‡æ¡£")])]),_._v(" "),v("ul",[v("li",[_._v("ã€ŠMySQLæŠ€æœ¯å†…å¹• InnoDBå­˜å‚¨å¼•æ“ ç¬¬2ç‰ˆã€‹")]),_._v(" "),v("li",[v("a",{attrs:{href:"https://juejin.cn/post/7120460698953941029#heading-6",target:"_blank",rel:"noopener noreferrer"}},[_._v("MySQL æ—¥å¿—ï¼šundo logã€redo logã€binlog"),v("OutboundLink")],1)])])])}),[],!1,null,null,null);v.default=e.exports}}]);