(window.webpackJsonp=window.webpackJsonp||[]).push([[82],{353:function(v,_,t){"use strict";t.r(_);var e=t(10),r=Object(e.a)({},(function(){var v=this,_=v._self._c;return _("ContentSlotsDistributor",{attrs:{"slot-key":v.$parent.slotKey}},[_("h1",{attrs:{id:"倒排索引"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#倒排索引"}},[v._v("#")]),v._v(" 倒排索引")]),v._v(" "),_("h2",{attrs:{id:"倒排索引的数据结构"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#倒排索引的数据结构"}},[v._v("#")]),v._v(" 倒排索引的数据结构")]),v._v(" "),_("blockquote",[_("p",[v._v("倒排表（Posting List），词项字典（Term Dictionary），词项索引（Term Index）")])]),v._v(" "),_("p",[v._v("倒排索引（Inverted Index）也叫反向索引，是通过"),_("code",[v._v("Value")]),v._v("去找"),_("code",[v._v("Key")]),v._v("，跟我们传统意义的根据"),_("code",[v._v("Key")]),v._v("找"),_("code",[v._v("Value")]),v._v("不太一样。")]),v._v(" "),_("p",[v._v("倒排索引的数据结构如下图：\n"),_("img",{attrs:{src:"/img/es/inverted-index-data-structure.jpg",alt:"倒排索引数据结构"}})]),v._v(" "),_("p",[v._v("举个例子：")]),v._v(" "),_("p",[v._v("假设有一个"),_("code",[v._v("user")]),v._v("表，它有四个字段：分别是"),_("code",[v._v("name")]),v._v(" "),_("code",[v._v("gender")]),v._v(" "),_("code",[v._v("age")]),v._v(" "),_("code",[v._v("address")]),v._v("。关系型数据库结构如下：")]),v._v(" "),_("table",[_("thead",[_("tr",[_("th",[v._v("ID")]),v._v(" "),_("th",[v._v("name")]),v._v(" "),_("th",[v._v("gender")]),v._v(" "),_("th",[v._v("age")]),v._v(" "),_("th",[v._v("address")])])]),v._v(" "),_("tbody",[_("tr",[_("td",[v._v("1")]),v._v(" "),_("td",[v._v("张三")]),v._v(" "),_("td",[v._v("1")]),v._v(" "),_("td",[v._v("22")]),v._v(" "),_("td",[v._v("上海市虹口区")])]),v._v(" "),_("tr",[_("td",[v._v("2")]),v._v(" "),_("td",[v._v("李四")]),v._v(" "),_("td",[v._v("2")]),v._v(" "),_("td",[v._v("25")]),v._v(" "),_("td",[v._v("安徽省合肥市")])]),v._v(" "),_("tr",[_("td",[v._v("3")]),v._v(" "),_("td",[v._v("王五")]),v._v(" "),_("td",[v._v("1")]),v._v(" "),_("td",[v._v("21")]),v._v(" "),_("td",[v._v("安徽省宣城市")])])])]),v._v(" "),_("ul",[_("li",[v._v("词项（Term）：一段文本进过分析器分析以后，就会输出一串"),_("code",[v._v("Term")]),v._v("。")]),v._v(" "),_("li",[v._v("词项字典（Term Dictionary）：Term（词项）的集合")]),v._v(" "),_("li",[v._v("词项索引（Term Index）：为了更快的找到某个词项，为"),_("code",[v._v("Term")]),v._v("建立索引")]),v._v(" "),_("li",[v._v("倒排表（Posting List）：倒排表记录了出现过每个词项（Term）的所有文档列表以及词项出现在该文档中的位置信息，每条记录称为倒排项（Posting）。\n根据倒排表，即可获知哪些文档包含某个词项。（"),_("strong",[v._v("实际的倒排表中并不只是存放文档ID这么简单，还有一些其他的信息，比如：词频，偏移量等")]),v._v("）")])]),v._v(" "),_("div",{staticClass:"custom-block tip"},[_("p",{staticClass:"custom-block-title"},[v._v("PS")]),v._v(" "),_("p",[v._v("如果类比现代汉语词典的话，那么"),_("code",[v._v("Term")]),v._v("就相当于词语，"),_("code",[v._v("Term Dictionary")]),v._v("相当于汉语词典本身，"),_("code",[v._v("Term Index")]),v._v("相当于词典的目录索引。")])]),v._v(" "),_("p",[v._v("我们知道，每个文档有一个"),_("code",[v._v("ID")]),v._v("，如果插入的时候没有指定的话，"),_("code",[v._v("Elasticsearch")]),v._v("会自动生成一个，上面的例子，"),_("code",[v._v("Elasticsearch")]),v._v("建立的索引大致如下：")]),v._v(" "),_("h3",{attrs:{id:"name-倒排索引"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#name-倒排索引"}},[v._v("#")]),v._v(" Name 倒排索引")]),v._v(" "),_("table",[_("thead",[_("tr",[_("th",[v._v("Term")]),v._v(" "),_("th",[v._v("Posting List")])])]),v._v(" "),_("tbody",[_("tr",[_("td",[v._v("张三")]),v._v(" "),_("td",[v._v("1")])]),v._v(" "),_("tr",[_("td",[v._v("李四")]),v._v(" "),_("td",[v._v("2")])]),v._v(" "),_("tr",[_("td",[v._v("王五")]),v._v(" "),_("td",[v._v("3")])])])]),v._v(" "),_("h3",{attrs:{id:"age-倒排索引"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#age-倒排索引"}},[v._v("#")]),v._v(" Age 倒排索引")]),v._v(" "),_("table",[_("thead",[_("tr",[_("th",[v._v("Term")]),v._v(" "),_("th",[v._v("Posting List")])])]),v._v(" "),_("tbody",[_("tr",[_("td",[v._v("22")]),v._v(" "),_("td",[v._v("1")])]),v._v(" "),_("tr",[_("td",[v._v("25")]),v._v(" "),_("td",[v._v("2")])]),v._v(" "),_("tr",[_("td",[v._v("21")]),v._v(" "),_("td",[v._v("3")])])])]),v._v(" "),_("h3",{attrs:{id:"gender-倒排索引"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#gender-倒排索引"}},[v._v("#")]),v._v(" Gender 倒排索引")]),v._v(" "),_("table",[_("thead",[_("tr",[_("th",[v._v("Term")]),v._v(" "),_("th",[v._v("Posting List")])])]),v._v(" "),_("tbody",[_("tr",[_("td",[v._v("1")]),v._v(" "),_("td",[v._v("[1,3]")])]),v._v(" "),_("tr",[_("td",[v._v("2")]),v._v(" "),_("td",[v._v("2")])])])]),v._v(" "),_("h3",{attrs:{id:"address-倒排索引"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#address-倒排索引"}},[v._v("#")]),v._v(" Address 倒排索引")]),v._v(" "),_("table",[_("thead",[_("tr",[_("th",[v._v("Term")]),v._v(" "),_("th",[v._v("Posting List")])])]),v._v(" "),_("tbody",[_("tr",[_("td",[v._v("上海市")]),v._v(" "),_("td",[v._v("1")])]),v._v(" "),_("tr",[_("td",[v._v("虹口区")]),v._v(" "),_("td",[v._v("1")])]),v._v(" "),_("tr",[_("td",[v._v("安徽省")]),v._v(" "),_("td",[v._v("[2,3]")])]),v._v(" "),_("tr",[_("td",[v._v("合肥市")]),v._v(" "),_("td",[v._v("2")])]),v._v(" "),_("tr",[_("td",[v._v("宣城市")]),v._v(" "),_("td",[v._v("3")])])])]),v._v(" "),_("p",[_("code",[v._v("Elasticsearch")]),v._v("分别为每个字段都建立了一个倒排索引。比如，在上面“张三”、“安徽省”、22 这些都是"),_("code",[v._v("Term")]),v._v("，而[2，3]就是"),_("code",[v._v("Posting List")]),v._v("。"),_("code",[v._v("Posting List")]),v._v("就是一个数组，存储了所有符合某个"),_("code",[v._v("Term")]),v._v("的文档"),_("code",[v._v("ID")]),v._v("。")]),v._v(" "),_("p",[v._v("只要知道文档"),_("code",[v._v("ID")]),v._v("，就能快速找到文档。那么要怎样通过我们给定的关键词快速找到这个"),_("code",[v._v("Term")]),v._v("呢？")]),v._v(" "),_("p",[v._v("这里就会引出接下来的两个概念，"),_("code",[v._v("Term Dictionary")]),v._v("和"),_("code",[v._v("Term Index")]),v._v("（"),_("strong",[v._v("可以把"),_("code",[v._v("Term Index")]),v._v("和"),_("code",[v._v("Term Dictionary")]),v._v("看成一步，就是找"),_("code",[v._v("Term")])]),v._v("）。")]),v._v(" "),_("p",[v._v("为了查找"),_("code",[v._v("Term")]),v._v("方便，"),_("code",[v._v("Elasticsearch")]),v._v("把所有的"),_("code",[v._v("Term")]),v._v("都排序了，且是二分法查找的。"),_("code",[v._v("Term Index")]),v._v("为了优化"),_("code",[v._v("Term Dictionary")]),v._v("，减少磁盘上的寻址开销。")]),v._v(" "),_("p",[_("img",{attrs:{src:"/img/es/inverted-index.png",alt:"倒排索引"}})]),v._v(" "),_("p",[v._v("这就是三者的关系，是一张很经典的图了，"),_("code",[v._v("Term Index")]),v._v("就存了一些前缀和映射关系，这样可以大大减少磁盘的随机读次数了。")]),v._v(" "),_("h2",{attrs:{id:"for-压缩算法"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#for-压缩算法"}},[v._v("#")]),v._v(" FOR 压缩算法")]),v._v(" "),_("p",[v._v("适合稠密的数组")]),v._v(" "),_("p",[_("code",[v._v("bit(比特)")]),v._v(" "),_("code",[v._v("byte")]),v._v("（字节），一个"),_("code",[v._v("byte")]),v._v("等于"),_("code",[v._v("8")]),v._v("个"),_("code",[v._v("bit")]),v._v("。磁盘存储最小的单位是"),_("code",[v._v("byte")]),v._v("。")]),v._v(" "),_("h2",{attrs:{id:"rbm-压缩算法"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#rbm-压缩算法"}},[v._v("#")]),v._v(" RBM 压缩算法")]),v._v(" "),_("p",[v._v("适合稀疏的数组")]),v._v(" "),_("p",[_("code",[v._v("Container")])]),v._v(" "),_("h2",{attrs:{id:"字典树"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#字典树"}},[v._v("#")]),v._v(" 字典树")]),v._v(" "),_("p",[_("a",{attrs:{href:"https://www.cs.usfca.edu/~galles/visualization/Trie.html",target:"_blank",rel:"noopener noreferrer"}},[v._v("Trie"),_("OutboundLink")],1),v._v(" 前缀树")]),v._v(" "),_("h2",{attrs:{id:"fst"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#fst"}},[v._v("#")]),v._v(" FST")]),v._v(" "),_("p",[v._v("FST（有限状态机），压缩"),_("code",[v._v("Term Index")]),v._v("。")]),v._v(" "),_("p",[_("strong",[v._v("参考文档")])]),v._v(" "),_("ul",[_("li",[_("a",{attrs:{href:"https://www.elastic.co/guide/cn/elasticsearch/guide/current/inverted-index.html",target:"_blank",rel:"noopener noreferrer"}},[v._v("倒排索引"),_("OutboundLink")],1)])])])}),[],!1,null,null,null);_.default=r.exports}}]);