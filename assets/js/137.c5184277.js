(window.webpackJsonp=window.webpackJsonp||[]).push([[137],{404:function(_,v,e){"use strict";e.r(v);var s=e(10),t=Object(s.a)({},(function(){var _=this,v=_._self._c;return v("ContentSlotsDistributor",{attrs:{"slot-key":_.$parent.slotKey}},[v("h1",{attrs:{id:"icp"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#icp"}},[_._v("#")]),_._v(" ICP")]),_._v(" "),v("blockquote",[v("p",[_._v("ICP（Index Condition Pushdown） 索引条件下推")])]),_._v(" "),v("p",[v("code",[_._v("MySQL 5.6")]),_._v("开始支持"),v("code",[_._v("ICP")]),_._v("（"),v("code",[_._v("Index Condition Pushdown")]),_._v("），用于优化数据查询。")]),_._v(" "),v("ul",[v("li",[_._v("不支持"),v("code",[_._v("ICP")]),_._v("之前，当进行索引查询时，首先根据索引来查找数据，然后再根据"),v("code",[_._v("where")]),_._v("条件来过滤，扫描了大量不必要的数据，增加了数据库"),v("code",[_._v("IO")]),_._v("操作。")]),_._v(" "),v("li",[_._v("在支持"),v("code",[_._v("ICP")]),_._v("后，"),v("code",[_._v("MySQL")]),_._v("在取出索引数据的同时，判断是否可以进行"),v("code",[_._v("where")]),_._v("条件过滤，"),v("strong",[_._v("将"),v("code",[_._v("where")]),_._v("的部分过滤操作放在存储引擎层")]),_._v("，提前过滤掉不必要的数据，减少了不必要数据被扫描带来的"),v("code",[_._v("IO")]),_._v("开销。")])]),_._v(" "),v("p",[_._v("索引条件下推的关键操作就是将与"),v("strong",[_._v("非主键索引")]),_._v("上相关的条件由"),v("code",[_._v("Server")]),_._v("层向下传递至"),v("code",[_._v("存储引擎层")]),_._v("，由此减少回表"),v("code",[_._v("IO")]),_._v("次数，大大提升了查询的效率。")]),_._v(" "),v("h2",{attrs:{id:"icp-特性"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#icp-特性"}},[_._v("#")]),_._v(" ICP 特性")]),_._v(" "),v("ol",[v("li",[_._v("支持"),v("code",[_._v("range")]),_._v("，"),v("code",[_._v("ref")]),_._v("，"),v("code",[_._v("eq_ref")]),_._v("，"),v("code",[_._v("ref_or_null")]),_._v("，并且需要回表查询的"),v("code",[_._v("非聚集索引")])]),_._v(" "),v("li",[_._v("支持"),v("code",[_._v("InnoDB")]),_._v("、"),v("code",[_._v("MyISAM")]),_._v("的普通表及分区表")]),_._v(" "),v("li",[_._v("对于"),v("code",[_._v("InnoDB")]),_._v("表，仅支持走"),v("code",[_._v("非聚集索引")]),_._v("的查询")]),_._v(" "),v("li",[v("code",[_._v("Explain")]),_._v(" 中 "),v("code",[_._v('Extra = "Using index condition; "')])])]),_._v(" "),v("p",[_._v("所以它不支持以下几点")]),_._v(" "),v("ol",[v("li",[_._v("不支持"),v("code",[_._v("主键索引")])]),_._v(" "),v("li",[_._v("不支持基于虚拟列的"),v("code",[_._v("辅助索引")])]),_._v(" "),v("li",[_._v("不支持"),v("code",[_._v("where")]),_._v("条件涉及子查询的")]),_._v(" "),v("li",[_._v("不支持"),v("code",[_._v("where")]),_._v("条件包含存储过程、函数的")])]),_._v(" "),v("h2",{attrs:{id:"explain-分析"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#explain-分析"}},[_._v("#")]),_._v(" EXPLAIN 分析")]),_._v(" "),v("p",[v("img",{attrs:{src:"/img/mysql/Using-index-condition.png",alt:"Using-index-condition"}})]),_._v(" "),v("p",[v("code",[_._v("Extra")]),_._v("显示的索引扫描方式如下:")]),_._v(" "),v("ul",[v("li",[v("code",[_._v("using where")]),_._v("：查询使用索引的情况下，需要回表去查询所需的数据。")]),_._v(" "),v("li",[v("code",[_._v("using index condition")]),_._v("：查询使用了索引，但是需要回表查询数据。")]),_._v(" "),v("li",[v("code",[_._v("using index")]),_._v("：查询使用覆盖索引的时候会出现。")]),_._v(" "),v("li",[v("code",[_._v("using index & using where")]),_._v("：查询使用了索引，但是需要的数据都在索引列中能找到，不需要回表查询数据。")])]),_._v(" "),v("h2",{attrs:{id:"icp-相关控制参数"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#icp-相关控制参数"}},[_._v("#")]),_._v(" ICP 相关控制参数")]),_._v(" "),v("p",[v("code",[_._v("index_condition_pushdown")]),_._v("：索引条件下推默认开启的，可以设置为"),v("code",[_._v("off")]),_._v("关闭"),v("code",[_._v("ICP")]),_._v("特性。")]),_._v(" "),v("div",{staticClass:"language-sql line-numbers-mode"},[v("pre",{pre:!0,attrs:{class:"language-sql"}},[v("code",[_._v("mysql"),v("span",{pre:!0,attrs:{class:"token operator"}},[_._v(">")]),v("span",{pre:!0,attrs:{class:"token keyword"}},[_._v("show")]),_._v(" variables "),v("span",{pre:!0,attrs:{class:"token operator"}},[_._v("like")]),_._v(" "),v("span",{pre:!0,attrs:{class:"token string"}},[_._v("'optimizer_switch'")]),v("span",{pre:!0,attrs:{class:"token punctuation"}},[_._v(";")]),_._v("\n\n"),v("span",{pre:!0,attrs:{class:"token comment"}},[_._v("# 开启或者关闭ICP特性")]),_._v("\nmysql"),v("span",{pre:!0,attrs:{class:"token operator"}},[_._v(">")]),v("span",{pre:!0,attrs:{class:"token keyword"}},[_._v("set")]),_._v(" optimizer_switch "),v("span",{pre:!0,attrs:{class:"token operator"}},[_._v("=")]),_._v(" "),v("span",{pre:!0,attrs:{class:"token string"}},[_._v("'index_condition_pushdown=on | off'")]),v("span",{pre:!0,attrs:{class:"token punctuation"}},[_._v(";")]),_._v("\n")])]),_._v(" "),v("div",{staticClass:"line-numbers-wrapper"},[v("span",{staticClass:"line-number"},[_._v("1")]),v("br"),v("span",{staticClass:"line-number"},[_._v("2")]),v("br"),v("span",{staticClass:"line-number"},[_._v("3")]),v("br"),v("span",{staticClass:"line-number"},[_._v("4")]),v("br")])])])}),[],!1,null,null,null);v.default=t.exports}}]);